<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{/layout/layout.html}">
<head>

<title>Insert title here</title>

<!-- date-picker & time-picker -->
<link rel="stylesheet" href="https://uicdn.toast.com/tui.time-picker/latest/tui-time-picker.css" />
<script src="https://uicdn.toast.com/tui.time-picker/latest/tui-time-picker.js"></script>
<link rel="stylesheet" href="https://uicdn.toast.com/tui.date-picker/latest/tui-date-picker.css" />
<script src="https://uicdn.toast.com/tui.date-picker/latest/tui-date-picker.js"></script>

<!-- 드래그 방지 -->
<script type="text/javascript">document.oncontextmenu = function(){return false;}</script>

<!-- custom style and js -->
<link rel="stylesheet" href="/equipmentCss/main.css"/>

</head>
<body><!-- 드래그 방지 -->

	<div layout:fragment="content" style="height: 900px; overflow: scroll; margin:15px;">
			  <h2>설비 보수 관리</h2>
  
		<div> 
            <!-- 탭 목록(버튼) 설정 -->
            <ul class="nav nav-tabs nav-pills" style="padding-top:15px;" id="myTab" role="tablist">
               <li class="nav-item" role="presentation">
                  <button class="nav-link active" id="maintenanceTab"
                     data-bs-toggle="tab" data-bs-target="#maintenance" type="button"
                     role="tab" aria-controls="maintenance" aria-selected="true" >점검</button>
               </li>
               <li class="nav-item" role="presentation">
                  <button class="nav-link" id="workTab" data-bs-toggle="tab"
                     data-bs-target="#work" type="button" role="tab"
                     aria-controls="work" aria-selected="false">공사</button>
               </li>
            </ul>
           
            <!-- 탭 본문 -->
            <div class="tab-content" id="myTabContent">
	               <!-- 보수 탭 -->
	               <div class="tab-pane fade show active" id="maintenance" role="tabpanel"
	                  aria-labelledby="maintenance-tab">
	                  <div style="margin: 15px;">
	                     <table style="width: 100%;">                        
	                           <tr>
	                              <td colspan="3">
	                                 <div class="row">
	                                    <div class="column">
	                                      <h5>점검 내역</h5>                                	
								            <div class="header">
								         	<button type="button" class="btn btn-dark btn-sm margin5"
								         		data-bs-toggle="modal" data-bs-target="#myModal1">등록</button>
								         		<input type="radio" name="tStatus0" checked="checked" onclick="completeChk()" value="전체" style="accent-color :#0000CD;">전체ㅤ
												<input type="radio" name="tStatus0" value="미완료" onclick="completeChk()" style="accent-color : #0000CD;">미완료ㅤ
												<input type="radio" name="tStatus0" value="완료" onclick="completeChk()" style="accent-color :#0000CD;">완료
											     <input onkeyup="filter()" style="float:right;" type="text" 
											     id="value" placeholder="Type to Search">
											 </div>
					      				   			   
	                                       <div id="testGrid">
	                                       </div>
	                                       
	                                    </div>
	                            
	                                 <!-- <div class="column">
	                                      <h5>고장 내역</h5>
	                                     	<div class="searchbox">
								            <div class="header">
								         	<button type="button" class="btn btn-dark btn-sm margin5"
								         	data-bs-toggle="modal" data-bs-target="#myModal3">등록</button>
								         		<input type="radio" name="tStatus1" checked="checked" onclick="completeChk()" value="전체" style="accent-color :#0000CD;">전체ㅤ
												<input type="radio" name="tStatus1" onclick="completeChk()" value="미완료" style="accent-color : #0000CD;">미완료ㅤ
												<input type="radio" name="tStatus1" onclick="completeChk()" value="완료" style="accent-color :#0000CD;">완료
											     <input onkeyup="filter()" style="float:right;" type="text" 
											     id="value" placeholder="Type to Search">
											 </div>
					      				   </div>
					      				   
	                                       <div id="failGrid">
	                                       </div>    
	                                    </div>	-->	 
	                                           		
	                                 </div>
	                              </td>
	                           </tr>                       
	                     </table>
	
	                  </div>
	
	               </div>
	               
	               <!-- 공사 탭 -->
	               <div class="tab-pane fade" id="work" role="tabpanel"
	                  aria-labelledby="work-tab">
	                  <div style="margin: 15px;">
	                     <table style="width: 100%;">
	                       		<tr>
	                              <td>
	                                 <div style="clear: both; margin: 15px;">  
	                                 	<div style="padding: 30px;">  
	                                      <h5>공사 결재 관리</h5>
	                                      <div class="searchbox">
							              <div class="header">
							         	  <button type="button" class="btn btn-dark btn-sm margin5"
							         	  data-bs-toggle="modal" id="insertWBtn" data-bs-target="#myModal5">등록</button>
										     <input type="radio" class="radio4" name="tStatus2" checked="checked" onclick="completeChk()" value="전체" style="accent-color :#0000CD;">전체ㅤ
											 <input type="radio" class="radio4" name="tStatus2" value="미승인" onclick="completeChk()" style="accent-color : #0000CD;">미승인ㅤ
											 <input type="radio" class="radio4" name="tStatus2" value="승인완료" onclick="completeChk()" style="accent-color :#0000CD;">승인완료	     
										     <input onkeyup="filter()" style="float:right;" 
										     type="text" id="value" placeholder="Type to Search">
										  </div>
				      				      </div>
	                                         
	                                      <div id="workGrid">
	                                      </div>
	                                    </div>			        		
	                                 </div>
	                              </td>
	                           </tr>
	                     </table>
	                  </div>
	               </div>
        </div>
	</div>
	
	<!-- The Modal 1 점검 등록 모달 -->
	<div class="modal fade" id="myModal1">
		<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
	
			<!-- Modal Header -->
			<div class="modal-header">
			<h4 class="modal-title">점검 등록</h4>
			<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
			</div>
	
			<form id="insertForm1" action="insertTest" method="post">
			<!-- <sec:csrfInput/> -->
			<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
			<!-- Modal body -->
			<div class="modal-body">
				<table class="table">
				  	<tr>
						<td>설비명</td>
                        <td>
                        	<input class="form-control" id="testNo" name="testNo" type="hidden" th:value="${tno}">
                        	<input class="form-control" id="testEquipName" name="testEquipName" type="hidden" th:value="${equipFirst.equipName}">
                        	<select class="form-control" id="equipNameSelect1" onchange="changeSelect(this.value,this.id);" required="required" >            							           
								           <option th:each="equip : ${equip}" >[[${equip.equipName}]]</option>
						  	</select>
						</td>    
                    </tr>
                    <tr>
						<td>점검예정일</td>
									<td>
										<div
											class="tui-datepicker-input tui-datetime-input tui-has-focus">
											<input id="t-start-input" type="text" name="testDueDate"
												aria-label="Date"  autocomplete="off"> <span
												class="tui-ico-date"></span>
											<div id="t-start-container" style="margin-left: -1px;"></div>
										</div>
									</td>
								</tr>
                    <tr>
                        <td>점검이유</td>
                        <td><input class="form-control" id="testReason" name="testReason" type="hidden" value="정기점검" required>
                        	<select class="form-control" id="testReasonSelect" onchange="changeSelect(this.value,this.id);" >            
								           <option>정기점검</option>
								           <option>기타</option>
						  	</select></td>    
                   </tr>
                    <tr>
                        <td>점검내용</td>
                        <td><textarea class="form-control " id="testContent" name="testContent" rows="5" readonly="readonly"
                        	onkeydown="resize(this)" style="color:gray; height :48px;">점검 후 기입 예정</textarea></td>
                    </tr> 
 				
               	 	</table>
			</div>
	
			<!-- Modal footer -->
			<div class="modal-footer">
			<button type="submit" class="btn btn-primary">등록</button>
			<button type="button" class="btn btn-danger" data-bs-dismiss="modal">취소</button>
			</div>
		</form>               
	
		</div>
		</div>
	</div>
	
	<!-- The Modal 2 점검 단건 조회 모달 -->
	<div class="modal fade" id="myModal2" data-backdrop="static" data-keyboard="false">
		
		<div class="modal-dialog modal-dialog-centered" >
			<div class="modal-content">
		
					<!-- Modal Header -->
					<div class="modal-header">
					<h4 class="modal-title"><span id="whatEno"></span>점검 정보</h4>
					<button type="button" onclick="cancelUpdateTest()" class="btn-close" data-bs-dismiss="modal"></button>
					</div>
					
				<form id="updateForm1" class="updateForm" method="post" name="test">
					<!-- <sec:csrfInput/> -->
					<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
					
					<!-- Modal body -->
					<div id="testInfo" class="modal-body">
						
					
						<table class="table">
		                    <tr>
								<td>설비명</td>
		                        <td><input class="form-control" id="sTestEquipName" name="testEquipName" type="text"  readonly></td> <!-- th:value="${equip.equipName}" -->             
		                    </tr>
		                    <tr>
		                    <td>점검예정일</td>
		                        <td>
		                        	<div class="tui-datepicker-input tui-datetime-input tui-has-focus">
				                    <input id="tv-start-input" type="text" name="testDueDate" 
				                    	aria-label="Date" style="background-color :#E9ECEF;" readonly>
				                    <span class="tui-ico-date"></span>
				                    <div id="tv-start-container" style="margin-left: -1px;"></div>				                   
				                    </div>
		                        </td>		
		                    </tr>
		                     <tr>
		                        <td>점검이유</td>
		                        <td><input class="form-control" id="sTestReason" name="testReason" 
		                       	 	 autocomplete="off" type="text" readonly></td>
		                     </tr>
		                     <tr>
		                        <td>점검내용</td> <!-- 특이사항 -->
		                        <td><textarea class="form-control wantUpdate1" id="sTestContent" name="testContent"
		                        	autocomplete="off" rows="5" readonly="readonly"></textarea></td>
                        	</tr>                  
		                     <tr>
		                        <td>진행상황</td> <!-- 특이사항 -->
		                        <td><input type="radio" class="radio2" name="testCodeName" value="미실시" style="accent-color :gray;" onclick="return(false);">미실시
									<input type="radio" class="radio2" name="testCodeName" value="진행중" style="accent-color : gray;" onclick="return(false);">진행중
									<input type="radio" class="radio2" name="testCodeName" value="보류" style="accent-color :gray;" onclick="return(false);">보류
									<input type="radio" class="radio2" name="testCodeName" value="점검완료" style="accent-color :gray;" onclick="return(false);">점검완료</td>
                        	</tr>                  
		                </table>
					</div>
		
						<!-- Modal footer -->
						<div class="modal-footer">
							<input id="update"type="hidden" >
							<button type="button" id="testUbtn" class="btn btn-primary" onclick="updateTBtnClick()">수정</button>					
							<button type="button" id="testDbtn" onclick="deleteTest()" class="btn btn-primary">삭제</button>
							<button type="button"  onclick="cancelUpdateTest()" class="btn btn-danger" data-bs-dismiss="modal">닫기</button>
							
							<input type="hidden" id="thisTNoUD" name="testNo"> <!-- 업데이트, 삭제 때문에 가져온 점검번호 값. -->
							<input type="hidden" id="thisTYnUD" name="testYn"> <!-- 업데이트, 삭제 때문에 가져온 점검유무 값. -->
							<input type="hidden" id="thisTCdUD" name="testCode"> <!-- 업데이트, 삭제 때문에 가져온 점검코드 값. -->
						
						</div>
				</form>
		
			</div>
		</div>
	</div>
	
		
	<!-- The Modal 3 고장 등록 모달 -->
	<div class="modal fade" id="myModal3">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
		
				<!-- Modal Header -->
				<div class="modal-header">
				<h4 class="modal-title">고장 등록</h4>
				<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>
		
				<form id="insertForm2" action="insertFail" method="post">
				<!-- <sec:csrfInput/> -->
				<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
				<!-- Modal body -->
				<div class="modal-body"> 
					<table class="table">	
	                    <tr>
	                        <td>설비명</td>
                        	<td>
	                        	<input class="form-control" id="failNo" name="failNo" type="hidden" th:value="${fno}">
	                        	<input class="form-control" id="failEquipName" name="failEquipName" type="hidden" th:value="${equipFirst.equipName}" >
	                        	<select class="form-control" id="equipNameSelect2" onchange="changeSelect(this.value,this.id);" required="required" >            							           
									           <option th:each="equip : ${equip}" >[[${equip.equipName}]]</option>
							  	</select>
							</td>    
	                    </tr>
	                    <tr>
		                    <td>고장발생일</td>
		                        <td>
		                        	<div class="tui-datepicker-input tui-datetime-input tui-has-focus">
				                    <input id="f-start-input" type="text" name="failDate" aria-label="Date" >
				                    <span class="tui-ico-date"></span>
				                    <div id="f-start-container" style="margin-left: -1px;"></div>
				                    </div>
		                        </td>		
		                    </tr>
	                    <tr>
	                        <td>고장내역</td>
	                        <td><textarea class="form-control textWidth resizeInsertForm" id="failContent" onkeydown="resize(this)" name="failContent" rows="5"></textarea></td>
	                    </tr>    
                        <tr>
	                        <td>수리내역</td>  
							<td><textarea class="form-control resizeInsertForm" id="failRepairContent" name="failRepairContent" rows="5"
							 	onkeydown="resize(this)" readonly="readonly"
                        		style="color:gray; height :48px;" >수리 후 기입 예정</textarea>
                        	</td>
                        </tr>                 
	                </table>
				</div>
		
				<!-- Modal footer -->
					<div class="modal-footer">
						<button type="submit" class="btn btn-primary">등록</button>
						<button type="button" class="btn btn-danger"  data-bs-dismiss="modal">닫기</button>
					</div>
			</form>
		
			</div>
		</div>
	</div>
	
	<!-- The Modal 4 고장 단건 조회 모달 -->
	<div class="modal fade" id="myModal4" data-backdrop="static" data-keyboard="false">
		
		<div class="modal-dialog modal-dialog-centered" >
			<div class="modal-content">
		
					<!-- Modal Header -->
					<div class="modal-header">
					<h4 class="modal-title"><span id="whatEno"></span>고장 정보</h4>
					<button type="button" onclick="cancelUpdateFail()" class="btn-close" data-bs-dismiss="modal"></button>
					</div>
		
				<form id="updateForm1" class="updateForm" method="post" name="equip">
				<!-- <sec:csrfInput/> -->
				<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
					
					<!-- Modal body -->
					<div id="failInfo" class="modal-body">
						
					
						<table class="table">
		                    <tr>
								<td>설비명</td>
		                        <td><input class="form-control" id="sFailEquipName" name="testEquipName" type="text"  readonly></td> <!-- th:value="${equip.equipName}" -->             
		                    </tr>
		                    <tr>
		                    <td>고장발생일</td>
		                        <td>
		                        	<div class="tui-datepicker-input tui-datetime-input tui-has-focus">
				                    <input id="fv-start-input" class="wantUpdate" type="text" name="failDate" aria-label="Date" style="background-color :#E9ECEF;" readonly>
				                    <span class="tui-ico-date"></span>
				                    <div id="fv-start-container" style="margin-left: -1px;"></div>
				                    </div>
		                        </td>		
		                    </tr>
		                     <tr>
		                        <td>고장내역</td>
		                        <td><input class="form-control wantUpdate "  id="sFailContent" name="failContent" type="text" readonly></td>
		                     </tr>
		                    <tr>
		                        <td>수리내역</td>
								<td><textarea class="form-control wantUpdate resizeInsertForm" id="sfailRepairContent" name="failRepairContent" rows="5"
								 	onkeydown="resize(this)" readonly="readonly"
	                        		style="color:gray; height :1px;">수리 후 기입 예정</textarea>
	                        	</td>
	                        </tr>                
		                     <tr>
		                        <td>진행상황</td> <!-- 특이사항 -->
		                        <td><input type="radio" name="failCode" value="미실시" checked="checked" style="accent-color :gray;" onclick="return(false);">미실시
									<input type="radio" name="failCode" value="진행중" style="accent-color : gray;" onclick="return(false);">진행중
									<input type="radio" name="failCode" value="보류" style="accent-color :gray;" onclick="return(false);">보류
									<input type="radio" name="failCode" value="점검완료" style="accent-color :gray;" onclick="return(false);">수리완료</td>
                        	</tr>                  
		                </table>
					</div>
		
						<!-- Modal footer -->
						<div class="modal-footer">
							<input id="update"type="hidden" >
							<button type="button"  class="btn btn-primary" onclick="updateBtnClick()">점검</button>
							<input type="hidden"  > <!-- 업데이트, 삭제 때문에 가져온 설비번호 값. -->
							<button type="button" class="btn btn-primary">삭제</button>
							<button type="button" class="btn btn-danger" data-bs-dismiss="modal">닫기</button>
						</div>
				</form>
		
			</div>
		</div>
	</div>
	
	
	<!-- The Modal 5 공사 등록 모달 -->
	<div class="modal fade" id="myModal5">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
		
				<!-- Modal Header -->
				<div class="modal-header">
				<h4 class="modal-title">공사 품의 등록</h4>
				<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>
		
				<form id="insertForm3" action="insertWork" method="post" onsubmit="return plzNum()">
				<!-- <sec:csrfInput/> -->
				<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
				<!-- Modal body -->
				<div class="modal-body"> 
					<table class="emp">
						<tr class="emp">
							<td>설비담당</td>
							<td>설비팀장</td>
							<td>생산팀장</td>
							<td>총괄팀장</td>
						</tr>
						<tr class="emp">
							<td style="text-align: center;"><img th:if="${session.usersAuthor == 'D0107'}" src="/equipmentCss/홍길동인.PNG"></td> <!-- 본인 도장 사진으로 대체 -->
							<td style="text-align: center;"><img th:if="${session.usersAuthor == 'D0108'}" src="/equipmentCss/홍길동인.PNG"></td> <!-- 본인 도장 사진으로 대체 -->
							<td></td>
							<td></td>
						</tr>
					</table>
					
					<br>
					<table class="table">	
	                    <tr>
	                        <td>공사명</td>
                        	<td><input class="form-control" id="workName" name="workName" autocomplete="off" type="text"></td>	  
	                    </tr>
	                    <tr>
	                    	<td>설비명</td> 
	                    	<td>
	                        	<input class="form-control" id="workNo" 
	                        			name="workNo" type="hidden" th:value="${wno}"> <!-- 공사번호 -->		
	                        	<input class="form-control" id="usersId" 
	                        			name="usersId" type="hidden" th:value="${session.usersId}"> <!-- 회원ID값 -->		
	                        	<input class="form-control" id="workEquipName"
	                        			name="workEquipName" type="hidden" th:value="${equipFirst.equipName}" >		
	                        	<select class="form-control" id="equipNameSelect3" onchange="changeSelect(this.value,this.id);" required="required" >            							           
									           <option th:each="equip : ${equip}" >[[${equip.equipName}]]</option>
							  	</select>
							</td>
	                    </tr>
	                      <tr>
	                        <td>시공일정</td>  
							<td>
							 	  <div class="tui-datepicker-input tui-datetime-input tui-has-focus">
				                  <input id="w-start-input" name="workDate" autocomplete="off" type="text" aria-label="Date">
				                  <span class="tui-ico-date"></span>
				                  <div id="w-start-container" style="margin-left: -1px;"></div>
				               	  </div>
				               <span>-</span>
				               <div class="tui-datepicker-input tui-datetime-input tui-has-focus">
				                  <input id="w-end-input" name="workEndDate" autocomplete="off" type="text" aria-label="Date">
				                  <span class="tui-ico-date"></span>
				                  <div id="w-end-container" style="margin-left: -1px;"></div>
				               </div>
							</td>	                     
                        </tr>
	                    <tr>
	                        <td>공사내용</td>
	                        <td><textarea class="form-control" id="workContent" name="workContent"  placeholder="입력하세요.." 
	                        	onkeydown="resize(this)" style="height :48px;" autocomplete="off" rows="5"></textarea></td> 
	                    </tr>
	                    <tr>
	                    	<td>특이사항</td>
	                        <td><textarea class="form-control" id="workPs" name="workPs"  placeholder="입력하세요.." 
	                        	onkeydown="resize(this)" style="height :48px;" autocomplete="off" rows="5"></textarea></td>
	                    </tr>
	                    <tr>
	                        <td>공사업체</td>
	                        <td><input class="form-control" id="workCompany" name="workCompany" type="hidden" value="(주)퐁퐁건설" required>
	                        	<select class="form-control" id="workCompanySelect" onchange="changeSelect(this.value,this.id);" >            
									           <option>(주)퐁퐁건설</option>
									           <option>(주)예담건설</option>
									           <option>(주)대구건설</option>
							  	</select>
							</td>
                  		</tr>
                        <tr>
	                        <td>예상비용</td>  
							<td><input class="form-control" style="text-align: right;" id="workPay" onkeyup="money(this)" name="workPay" type="text" required></td>
                        </tr>
                        <tr>
	                        <td></td>
			                <td style="text-align: right;"><h6>설비담당 [[${session.usersName}]] 결재 올림</h6></td>
                        </tr>   
                           
	                </table>
	                
	                
				</div>
		
				<!-- Modal footer -->
					<div class="modal-footer">
						<button type="submit" class="btn btn-primary">등록</button>
						<button type="button" class="btn btn-danger"  data-bs-dismiss="modal">닫기</button>
					</div>
			</form>
		
			</div>
		</div>
	</div>

	<!-- The Modal 6 공사 단건 조회 모달 -->
	<div class="modal fade" id="myModal6" data-backdrop="static" data-keyboard="false">
		
		<div class="modal-dialog modal-dialog-centered" >
			<div class="modal-content">
		
					<!-- Modal Header -->
					<div class="modal-header">
					<h4 class="modal-title">공사 정보</h4>
					<button type="button" onclick="cancelUpdateWork()" class="btn-close" data-bs-dismiss="modal"></button>
					</div>
		
				<form id="updateForm3" class="updateForm" method="post" name="equip" onsubmit="return plzNum()">
				<!-- <sec:csrfInput/> -->
				<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
					
					<!-- Modal body -->
					<div id="workInfo" class="modal-body">
							<div class="modal-body" style="padding: 0.3rem;"> 
					<table class="emp" >
						<tr class="emp">
							<td>설비사원</td>
							<td>설비팀장</td>
							<td>생산팀장</td>
							<td>총괄팀장</td>
						</tr>
						<tr class="emp">
							<td style="text-align: center;"><img id="seq1" style="visibility: hidden;" src="/equipmentCss/홍길동인.PNG"></td>
							<td style="text-align: center;"><img id="seq2" style="visibility: hidden;" src="/equipmentCss/홍길동인.PNG"></td>
							<td style="text-align: center;"><img id="seq3" style="visibility: hidden;" src="/equipmentCss/홍길동인.PNG"></td>
							<td style="text-align: center;"><img id="seq4" style="visibility: hidden;" src="/equipmentCss/홍길동인.PNG"></td>
						</tr>
					</table>
					<button type="button" id="updateWSBtn" class="btn btn-primary updateBtn" style="float:right; visibility: hidden;" onclick="updateWSBtnClick()">승인</button><!-- WS : WorkSign -->
					<br>
					
						<table class="table">
		                    <tr>
								<td>공사명</td>
		                        <td><input class="form-control wantUpdate3" id="sWorkName" name="workName" type="text"  readonly></td> <!-- th:value="${equip.equipName}" -->             
		                    </tr>
		                    <tr>
								<td>설비명</td>
		                        <td>
			                        <input class="form-control wantUpdate3" id="sWorkEquipName" name="workEquipName" type="text" readonly>
			                        <select class="form-control wantUpdate3" id="sEquipNameSelect3" style="display: none;" onchange="changeSelect(this.value,this.id);" required="required" >            							           
										           <option th:each="equip : ${equip}" >[[${equip.equipName}]]</option>
								  	</select>
		                        </td> <!-- th:value="${equip.equipName}" -->
		                    </tr>
		                   	<tr>
	                        	<td>시공일정</td>  
								<td>
								 	  <div class="tui-datepicker-input tui-datetime-input tui-has-focus">
					                  <input id="wv-start-input" name="workDate" autocomplete="off" type="text" aria-label="Date" 
					                  		style="background-color :#E9ECEF;" readonly>
					                  <span class="tui-ico-date" ></span>
					                  <div id="wv-start-container" style="margin-left: -1px;"></div>
					               	  </div>
					               <span>-</span>
					               <div class="tui-datepicker-input tui-datetime-input tui-has-focus">
					                  <input id="wv-end-input" name="workEndDate" autocomplete="off" type="text" aria-label="Date" 
					                  		style="background-color :#E9ECEF;" readonly>
					                  <span class="tui-ico-date"></span>
					                  <div id="wv-end-container" style="margin-left: -1px;"></div>
					               </div>
								</td>
							</tr>
							
							 <tr>
		                        <td>공사내용</td>
		                        <td><input class="form-control wantUpdate3" 
		                        		style=" height :48px;" id="sWorkContent" name="workContent" type="text" readonly></td>
		                     </tr>

							 <tr>
		                        <td>특이사항</td>
								<td><textarea class="form-control wantUpdate3 " id="sWorkPs" name="workPs" rows="5"
								 	 style="height :48px;" readonly="readonly"></textarea>
	                        	</td>
	                        </tr>

							 <tr>
		                        <td>공사업체</td>
		                        <td><input class="form-control wantUpdate3"  id="sWorkCompany" name="workCompany" type="text" readonly>
		                        	<select class="form-control" style="display: none;" id="sWorkCompanySelect" onchange="changeSelect(this.value,this.id);" >            
									           <option>(주)퐁퐁건설</option>
									           <option>(주)예담건설</option>
									           <option>(주)대구건설</option>
							  		</select>
		                        </td>
		                     </tr>
		                     
		                     <tr>
		                        <td>예상비용</td>
		                        <td>
		                        	<input class="form-control wantUpdate3" style="text-align: right;" onkeyup="money(this)" id="sWorkPay" name="workPay" type="text" readonly>
		                        </td> 
		                     </tr>
		                     <tr>
		                     <td></td>
		                     <td style="text-align: right;"><h6 id="writer"></h6></td>
		                     </tr>              
		                </table>
					</div>
					</div>
		
						<!-- Modal footer -->
						<div class="modal-footer">
							<button type="button" id="updateWBtn" class="btn btn-primary updateBtn3" onclick="updateWBtnClick()">수정</button> <!--  -->
							
							<input type="hidden" id="thisSeqU" name="signSeq"> <!-- 결재순서 업데이트 때문에 가져온 값. -->
							<input type="hidden" id="thisSCdU" name="signCode"> <!-- 업데이트, 삭제 때문에 가져온 결재코드 값. -->
							<input type="hidden" id="thisWNoUD" name="workNo"> <!-- 업데이트, 삭제 때문에 가져온 공사번호 값. -->
							
							<button type="button" id="deleteWBtn" onclick="deleteWork()" class="btn btn-primary">삭제</button>
							<button type="button"  onclick="cancelUpdateWork()"  class="btn btn-danger" data-bs-dismiss="modal">닫기</button>
						</div>
				
				</form>
				
			</div>
		</div>
	</div>

<script type="text/javascript">
/* JAVASCRIPT *//* JAVASCRIPT *//* JAVASCRIPT *//* JAVASCRIPT *//* JAVASCRIPT *//* JAVASCRIPT *//* JAVASCRIPT *//* JAVASCRIPT *//* JAVASCRIPT *//* JAVASCRIPT *//* JAVASCRIPT */
/* JAVASCRIPT *//* JAVASCRIPT *//* JAVASCRIPT *//* JAVASCRIPT *//* JAVASCRIPT *//* JAVASCRIPT *//* JAVASCRIPT *//* JAVASCRIPT *//* JAVASCRIPT *//* JAVASCRIPT *//* JAVASCRIPT */	


/* 숫자만 적으세요 그리고 음수는 안돼요 함수 미사용중 */

function money(input){
	
input.addEventListener('keyup', function(e) {
  let value = e.target.value;
  value = Number(value.replaceAll(',', ''));
  
  if(isNaN(value)) {
    input.value = 0;
  }else {
    const formatValue = value.toLocaleString('ko-KR');
    input.value = formatValue;
  }
})

}

function plzNum(){
	let money = document.getElementById('workPay');
	let smoney = document.getElementById('sWorkPay');
	
	money.value= Number(money.value.replaceAll(',', ''));
	smoney.value= Number(smoney.value.replaceAll(',', ''));
	
	//다 만족하면 true
	
	return true;

}

/* textarea_자동_높이_조절 함수 */
function resize(obj) {
  obj.style.height = "28px";
  obj.style.height = (12+obj.scrollHeight)+"px";
}


/* 점검할 또는 고장난 또는 공사할 설비명 선택하게 하는 함수 */ 
	function changeSelect(val,id) { 
		let tag = document.getElementById(id);
		console.log(tag.previousElementSibling.id);	
		tag.previousElementSibling.value = val;
	}
	
/* 점검할 또는 고장난 또는 공사할 설비명 디폴트값 미사용중 */ 
function test (id){
	let tag = document.querySelector(id);
	tag.value = tag.nextSibling.firstChild.innerText;
}

	
/*------------
   // 탭 버튼 클릭
   ----------------*/
	const mt = document.querySelector('#maintenanceTab');
  	mt.addEventListener('shown.bs.tab',function(){ // 탭과 관련되어있어서
	   testGrid.refreshLayout();
 	  //failGrid.refreshLayout();
	});
	
	const wt = document.querySelector('#workTab');
	wt.addEventListener('shown.bs.tab',function(){
	   workGrid.refreshLayout();
 	  	
	});
   

/*  점검 그리드  */	
	const testGrid = new tui.Grid({
			    el: document.querySelector('#testGrid'),
			    pagination:true,
				pageOptions: {
					useClient: true,
					perPage: 10
				},
			    columns: [
			    {
					header:'점검번호',
					name:'testNo'
					,align : 'center'
				},
			    {
			        header: '설비명',
			        name: 'testEquipName'
			        ,align : 'center'
			    },
			    {
			        header: '점검예정일',
			        name: 'testDueDate'
			        ,align : 'center'
			    },
			    {
			        header: '점검사유',
			        name: 'testReason'
			        ,align : 'center'
			    },
			    {
			        header: '점검내역',
			        name: 'testContent'
			        ,align : 'center'
			    },
			    {
			        header: '진행상황',
			        name: 'testCodeName'
			        ,align : 'center'
			    }
			    ]
			});

/* 점검 전체 리스트 불러오는 아작스 */

	url="/equipment/testAllList"
	fetch(url) 
	.then(res=>res.json())
	.then(obj=>{
	    console.log(obj);
	  testGrid.resetData(obj);
	})	
	

	

/*  점검 단건조회 불러오는 아작스 함수 */

	function getTestNo(testNo,testEquipNo) {
			
		    url="/equipment/getTestInfo?testNo="+testNo+"&testEquipNo="+testEquipNo // get방식이라 ?equipNo=
		    fetch(url) 
		    .then(res=>res.json())
		    .then(obj=>{
		        console.log(obj);
		    
				document.querySelector('#sTestEquipName').value=obj.testEquipName;
				document.querySelector('#thisTNoUD').value=obj.testNo;
				document.querySelector('#thisTYnUD').value=obj.testYn;	
				
				let tCode = document.querySelector('#thisTCdUD').value;
					  tCode = obj.testCode;
					  
				document.querySelector('#tv-start-input').value=obj.testDueDate;
		        document.querySelector('#sTestReason').value=obj.testReason; 
		        
		        let tContent= document.querySelector('#sTestContent'); 
		        	
		        if(obj.testContent != null && tContent.value != '')
		        	tContent.value = obj.testContent;	        		
		        	
				const radios = document.getElementsByClassName('radio2');
			    const btn1 = document.querySelector('#testUbtn'); // 수정버튼
			    const btn2 = document.querySelector('#testDbtn'); // 삭제버튼

			    btn1.style.display='block'; //초기화
				btn2.style.display='block'; //초기화
				
			    if(tContent != '') {
							tContent.value = obj.testContent;
			    
					if(tCode=='A0103'){ // 조회한 글이 완료상태라면
						
							btn1.style.display='none';
							btn2.style.display='none';
							//.visibility= 'hidden';			
								
					} else { // 조회한 글이 미완료라면
						
							btn1.style.display='block';
							btn2.style.display='block';
					}	
					
					if(tContent.value != ''){ //그런데 수정도 한 번 했다면
									
							for (var i = 0; i< radios.length; i++)
							radios[i].checked=false; //체크되어있는 항목 모두 해제 => 초기화			
						        	
							if(tCode=='A0101') radios[0].checked=true;
							else if (tCode=='A0102') radios[1].checked=true;
							else if (tCode=='A0106') radios[2].checked=true;
							else radios[3].checked = true;
						
					}
			  }
		  })
	    
	}

	
/* 점검 그리드 셀 클릭-> 모달 팝업 이벤트 */
		 
	    testGrid.on('click', ev => {
	    	const tnoRow = testGrid.getRow(ev.rowKey); // 행 (객체)
	    	const tno = tnoRow.testNo; // 행의 점검번호
	    	const eno = tnoRow.testEquipNo; // 행의 설비번호
	    	console.log(tno);
	   	/* if(equip.getValue(ev.rowKey,ev.columnName) == equipInfo)) */
	    	console.log(ev);
	    	
	    	if(ev.rowKey == tnoRow.rowKey){
				if(tno != null){
		    	const myModal2 = new bootstrap.Modal('#myModal2',{backdrop: 'static',keyboard:false})
		    	// 생성 시 모달 속성을 넣어줍니다.
		    	const modalToggle2 = document.getElementById('myModal2'); 
		    	
				getTestNo(tno,eno);
		    	myModal2.show(modalToggle2);
		    	
				}
	    	}
		});

		

/* 점검 수정 버튼 누른 함수 */
			function updateTBtnClick() {
				
				console.log("점검 수정 버튼 클릭");
				
				const wu = document.getElementsByClassName('wantUpdate1');	 // 점검1 고장2 공사3
			    const tCode = document.querySelector('.radio2:checked');
				const radios = document.getElementsByClassName('radio2');	// 배열
				const tContent= document.querySelector('#sTestContent');
				//onkeydown="resize(this)" 추가
				
					for (var i = 0; i< wu.length; i++) {
			            wu[i].readOnly = false;
			            wu[i].required = true;
			            
			        }
			        
				if(tCode.value == '' || tCode.value != '점검완료'){
					
					tContent.style.color='black'; // 새로작성할 점검내역 글씨색 검정색
					
					for (var i = 0; i< radios.length; i++) {
						radios[i].removeAttribute("onclick"); // 온클릭 false 해제 => 선택가능
						radios[i].style.accentColor='#0000CD';
			        }
				}

				console.log(tCode);
				
				const btn = document.querySelector('#testUbtn')
				
				btn.innerHTML='저장';
				btn.removeAttribute("onclick"); // 기존 onclick 제거.
				btn.addEventListener('click',updateTest); // 저장버튼에 수정함수 클릭이벤 도입
				
	
			}

/* 점검 수정 함수 */	
			
		function updateTest() {
	
				const url1="/equipment/updateTest1"; //1이 완료
				const url2="/equipment/updateTest2"; //2가 진행중
				const data = new FormData(document.getElementById('updateForm1'));
				const wu = document.getElementsByClassName('wantUpdate1');
			    const btn = document.querySelector('#testUbtn');
			    const radio = document.querySelector('input[name="testCodeName"]:checked').value;
			    const radios = document.getElementsByClassName('radio2');
			    const tContent= document.querySelector('#sTestContent');
		
			    // DB에 보낼 코드 값
				let tcon = tContent.value;
			    	
				if( radio == '점검완료'){
						console.log(tcon);
						if(confirm('점검완료 처리하시겠습니까? 수정이 불가능 합니다.')){
								// 네 -> 점검 완료 수정불가 상태
								//최종점검완료 아작스 
								console.log("최종수정 아작스 전송");
								
								
								 fetch(url1, {method: 'POST', body : data})
								    .then(res=>res.json())
								    .then(obj=>{
								        console.log(obj);
								        
								    // 업데이트 하고자 하는 애들  닫아주기
									 	for (var i = 0; i< wu.length; i++) {
									 		
								            wu[i].readOnly =true;
								            wu[i].required = false;
								        }
									 // wu[0].style.backgroundColor='#E9ECEF';
										 
					    			btn.setAttribute('type', 'hidden'); //수정 이제 못하도록 안보이게
									btn.removeEventListener('click',updateTest);
									btn.setAttribute('onclick','updateTBtnClick()');
								  	alert('점검완료!');
									
								  	location.reload(true);// 새로고침			   
								    
									})
									.catch((error) => console.log("error:", error));
							}else {
								
								for (var i = 0; i< radios.length; i++) {
									
										radios[i].checked=false; //체크되어있는 항목 모두 해제		
						        	}
									
										radios[3].checked = true; // 그대로 점검완료에 checked
										tContent.value = tcon;
								}
					
				} else { // 점검완료가 아니면
						 // 단순 수정 아작스
					
						console.log("단순 수정 아작스 전송");
					
						fetch(url2, {method: 'POST', body : data})
						    .then(res=>res.json())
						    .then(obj=>{
						        console.log(obj);	  
						        console.log(obj.testCodeName);
						      
						   // 업데이트 하고자 하는 애들 다시 닫아주기
							 	for (var i = 0; i< wu.length; i++) {			
						            wu[i].readOnly = true;
						            wu[i].required = false;
						        }				 							

								
								btn.innerText='수정';
								btn.removeEventListener('click',updateTest); 
							  	btn.setAttribute('onclick','updateTBtnClick()');
							  	
							  	alert('수정완료!');
							  	
								if(obj.testCodeName='미실시')
									 radios[0].checked=true;
								else if(obj.testCodeName='진행중')
									 radios[1].checked=true;
								else if(obj.testCodeName='보류')
									 radios[2].checked=true;
					 
						    
				 	})
					.catch((error) => console.log("error:", error));
					
					location.reload(true);// 새로고침
				}   
				      		
			}
	
			
			
/* 점검 수정 취소 함수 */
			
			function cancelUpdateTest() { // 되감기^^
	
				console.log("수정 취소버튼 클릭");
				
				const wu = document.getElementsByClassName('wantUpdate1');
			    const tCode = document.querySelector('.radio2:checked'); // 체크한 값.
				const btn = document.querySelector('#testUbtn');
				const tContent= document.querySelector('#sTestContent');
					
					
						 	
						 if(tContent.value == '' || tCode!='점검완료'){ // 수정 아예 안했거나 완료가 아니라면.
						
							for (var i = 0; i< wu.length; i++) {
					            wu[i].readOnly =true;
					            wu[i].required = false;
					        }							 	
							 	
							const radio = document.getElementsByClassName('radio2');
								// 배열
							for (var i = 0; i< radio.length; i++) {
								
									radio[i].setAttribute("onclick","return false"); // 온클릭 false 해제 => 선택가능
									radio[i].style.accentColor='gray';	   
									//radio[i].checked=false; //체크되어있는 항목 모두 해제		
						        }
							 if(tContent.value == ''){ //점검을 아예 건들지도 않았다면..
							 	radio[0].checked = true; // 첫 번째만 checked
							 }
							btn.innerText='수정';
							btn.removeEventListener('click',updateTest);
							btn.setAttribute('onclick','updateTBtnClick()');
					}
				}
				
 // 점검 삭제 하는 함수 
function deleteTest() {

	 // 삭제하는데 사용할 변수 가져오기

	const testNo = document.getElementById('thisTNoUD').value

	const url1="/equipment/deleteTestNo/"+testNo // 매개변수 번호를 넘겨야됨.
	const url2="/equipment/updateDeleteTestNo/"+testNo // 매개변수 번호를 넘겨야됨.
				
	const wu = document.getElementsByClassName('wantUpdate1');	 
					
			for (var i = 0; i< wu.length; i++) {
				wu[i].readOnly =true;
				wu[i].required = false;
			  }	
		console.log('삭제 아작스 전송');
		
		 fetch(url1,{method: 'DELETE', headers: {
	         'header' : header,
		     'X-CSRF-Token': token }})
			 .then(res=> res.text())
		     .then(obj=>{
				console.log(obj);
				console.log('삭제완료!');
				location.reload(true);// 새로고침
		})
 }
		 
//============================================================================================================================================================		
			
/* 	
  고장 그리드 
		const failGrid = new tui.Grid({
		    el: document.querySelector('#failGrid'),
		    pagination:true,
			pageOptions: {
				useClient: true,
				perPage: 4
			},
		    columns: [
		    {
				header:'고장번호',
				name:'failNo'
				,align : 'center'
			},
		    {
		        header: '설비명',
		        name: 'failEquipName'
		        ,align : 'center'
		    },
		    {
		        header: '고장발생일',
		        name: 'failDate'
		        ,align : 'center'
		    },
		    {
		        header: '고장내역',
		        name: 'failContent'
		        ,align : 'center'
		    },
		    {
		        header: '수리내역',
		        name: 'failRepairContent'
		        ,align : 'center'
		    },
		    {
		        header: '진행상황',
		        name: 'failCode'
		        ,align : 'center'
		    }
		    ]
		});
		
 고장 리스트 불러오는 아작스
	    
	    url="/equipment/failAllList"
	    fetch(url) 
	    .then(res=>res.json())
	    .then(obj=>{
	        console.log(obj);
	        failGrid.resetData(obj);
	        
	    })
 고장 그리드 셀 클릭-> 모달 팝업 이벤트
		 
	    failGrid.on('click', ev => {
	    	const fnoRow = failGrid.getRow(ev.rowKey); // 행 (객체)
	    	const fno = fnoRow.failNo; // 행의 점검번호
	    	const eno = fnoRow.failEquipNo; // 행의 설비번호
	    	console.log(fno);
	   	
	    	console.log(ev);
	    	
	    	if(ev.rowKey == fnoRow.rowKey){
				if(fno != null){
		    	const myModal4 = new bootstrap.Modal('#myModal4',{backdrop: 'static',keyboard:false})
		    	// 생성 시 모달 속성을 넣어줍니다.
		    	const modalToggle4 = document.getElementById('myModal4'); 
		    	
				getFailNo(fno,eno);
		    	myModal4.show(modalToggle4);
		    	
				}
	    	}
		});
		
 고장 단건조회 불러오는 아작스 함수

		function getFailNo(failNo,failEquipNo) {
				
			    url="/equipment/getFailInfo?failNo="+failNo+"&failEquipNo="+failEquipNo // get방식이라 ?equipNo=
			    fetch(url) 
			    .then(res=>res.json())
			    .then(obj=>{
			        console.log(obj);
    
					document.querySelector('#sFailEquipName').value=obj.failEquipName;
					document.querySelector('#fv-start-input').value=obj.failDate;
			        document.querySelector('#sFailContent').value=obj.failContent;
			       
			    })
		    
			}	    
			*/


//============================================================================================================================================================		




/*  공사 그리드  */	
		
		const workGrid = new tui.Grid({
		    el: document.querySelector('#workGrid'),
		    pagination:true,
			pageOptions: {
				useClient: true,
				perPage: 4
			},
		    columns: [
		    {
			   	header:'공사번호',
			    name:'workNo'
			    ,align : 'center'
			},
		    {
		        header: '공사명',
		        name: 'workName'
		        ,align : 'center'
		    },
		    {
		        header: '시공예정일',
		        name: 'workDate'
		        ,align : 'center'
		    },
		    {
		        header: '공사비용',
		        name: 'workPay'
		        ,align : 'right'
		        ,formatter: function(value) {
	                return value.value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',')+' 원'; // 3자리 마다 
	            }
		    },
		    {
		        header: '결재정보',
		        name: 'signCode'
		        ,align : 'center'
		    },
		    {
		        header: '진행상황',
		        name: 'workCode'
		        ,align : 'center'
		    }
		    ]
		});

/* 공사 전체 리스트 불러오는 아작스 */
	    
	    url="/equipment/workAllList"
	    fetch(url) 
	    .then(res=>res.json())
	    .then(obj=>{
	        console.log(obj);
	        workGrid.resetData(obj);
	        
	    })
	    
/* 공사 그리드 셀 클릭-> 모달 팝업 이벤트 */
		 
	    workGrid.on('click', ev => {
	    	const wnoRow = workGrid.getRow(ev.rowKey); // 행 (객체)
	    	const wno = wnoRow.workNo; // 행의 공사번호
	    	const eno = wnoRow.workEquipNo; // 행의 설비번호
	    	console.log(wno);
	   	/* if(equip.getValue(ev.rowKey,ev.columnName) == equipInfo)) */
	    	console.log(ev);
	    	
	    	if(ev.rowKey == wnoRow.rowKey){
				if(wno != null){
		    	const myModal6 = new bootstrap.Modal('#myModal6',{backdrop: 'static',keyboard:false})
		    	// 생성 시 모달 속성을 넣어줍니다.
		    	const modalToggle6 = document.getElementById('myModal6'); 
		    	
				getWorkNo(wno,eno);
		    	myModal6.show(modalToggle6);
		    	
				}
	    	}
		});
		
/*  공사 단건 조회 불러오는 아작스 함수 */

function getWorkNo(workNo,workEquipNo) {
	
				const usersNo = `[[${session.usersNo}]]`;
				const usersAuthor = `[[${session.usersAuthor}]]`;
				const updateWBtn = document.querySelector('#updateWBtn');
				const deleteWBtn = document.querySelector('#deleteWBtn');
				const updateWSBtn = document.querySelector('#updateWSBtn');
				
				// 결재승인 사인, 수정/삭제 버튼 초기화
		        document.getElementById('seq1').style.visibility='hidden';
		        document.getElementById('seq2').style.visibility='hidden';
		        document.getElementById('seq3').style.visibility='hidden';
		        document.getElementById('seq4').style.visibility='hidden';
		        updateWSBtn.style.visibility='hidden';
		        updateWBtn.style.display='block'; 
	        	deleteWBtn.style.display='block';
				
				
			    url="/equipment/getWorkInfo?workNo="+workNo+"&workEquipNo="+workEquipNo // get방식이라 ?equipNo=
			    fetch(url) 
			    .then(res=>res.json())
			    .then(obj=>{
			        console.log(obj);
			        
			        if(obj.signEmpNo != usersNo){ // 작성자랑 다른사람이면 수정못하게
			        	updateWBtn.style.display='none';
			        	deleteWBtn.style.display='none';
			        }
   
			        if(obj.signSeq > 0){ // 조회한 글의 seq가 1이상이면
			        	
			        	document.getElementById('seq1').style.visibility='visible'; // 사원의 사인이 보여라!
			        	if(obj.signSeq == 1 && usersAuthor =='D0108') updateWSBtn.style.visibility='visible'; // 설비팀장이면 승인 버튼이 보여라!
			        	     	
				        if(obj.signSeq > 1){ // seq가 2이상이면 도장이 2개
				        	
					        	document.getElementById('seq2').style.visibility='visible'; // 팀장의 사인도 보여라!
					        	if(obj.signSeq ==2 && usersAuthor =='D0106') updateWSBtn.style.visibility='visible'; // 생산팀장이면 승인 버튼이 보여라!
					        	updateWBtn.style.display='none'; // 한번 승인되면 수정버튼 보이지 않도록.
					        	deleteWBtn.style.display='none'; // 한번 승인되면 수정버튼 보이지 않도록.
					        	
						        if(obj.signSeq > 2){ // seq가 3이상이면
						        	document.getElementById('seq3').style.visibility='visible'; // 생산팀장의 사인까지 보여라!
						        	if(obj.signSeq ==3 && usersAuthor =='D0111') updateWSBtn.style.visibility='visible';  
						        	
							        	 if(obj.signSeq > 3){ // seq가 3이상이면
									        	document.getElementById('seq4').style.visibility='visible'; // 총괄팀장의 사인까지 보여라!
							        
							        	 }
						        }
				          }     	
			        }
			        
					document.querySelector('#sWorkName').value=obj.workName;
					document.querySelector('#sWorkEquipName').value=obj.workEquipName;
					document.querySelector('#sWorkPs').value=obj.workPs;
					document.querySelector('#thisSeqU').value=obj.signSeq;
					document.querySelector('#thisSCdU').value=obj.signCode;
					document.querySelector('#thisWNoUD').value=obj.workNo;
					document.querySelector('#writer').innerText=obj.position+" "+obj.usersName+", 결재 올림";
					
					// 숫자 자리에 콤마 찍기
					const money = document.querySelector('#sWorkPay');
					money.value = obj.workPay.toLocaleString('ko-KR');
					money.style.textAlign='right';
					
					document.querySelector('#sWorkCompany').value=obj.workCompany;
					document.querySelector('#wv-start-input').value=obj.workDate;
					document.querySelector('#wv-end-input').value=obj.workEndDate;
			        document.querySelector('#sWorkContent').value=obj.workContent;
			       
			    })
		    
}

/* 공사 승인 버튼 누른 함수 */
function updateWSBtnClick() {
	
	plzNum();
	console.log("승인 버튼 클릭");
	const data = new FormData(document.getElementById('updateForm3'));
	
	//const btn = document.querySelector('#updateWSBtn');
	//const seq = document.querySelector('#thisSeqU').value;
	//const usersNo = `[[${session.usersAuthor}]]`;
		
		if(confirm('결재 승인 처리하시겠습니까? 철회가 불가능 합니다.')){
		
					console.log("승인 아작스 전송");
					
					 url="/equipment/updateSignSeq"
					 fetch(url, {method: 'POST', body : data})
					    .then(res=>res.json())
					    .then(obj=>{
					        
						  	alert('승인완료!');
							
						  	location.reload(true);// 새로고침			   		  	
					  	
						})
						.catch((error) => console.log("error:", error));
					 
	 }
						
}



/* 공사 수정 버튼 누른 함수 */
function updateWBtnClick() {
	
	console.log("공사 수정 버튼 클릭");
	
	let smoney = document.getElementById('sWorkPay');
	
	const wu = document.getElementsByClassName('wantUpdate3');	 // 점검1 고장2 공사3
	const wContent= document.querySelector('#sWorkContent');
	const wCompany= document.querySelector('#sWorkCompany');
	const wCompanySelect= document.querySelector('#sWorkCompanySelect');
	const wEquipName= document.querySelector('#sWorkEquipName');
	const eqNameSelect3= document.querySelector('#sEquipNameSelect3');
	
	wCompany.style.display='none';
	wCompanySelect.style.display='block';
	wEquipName.style.display='none';
	eqNameSelect3.style.display='block';
	
		for (var i = 0; i< wu.length; i++) {
            wu[i].readOnly = false;
            wu[i].required = true;
        }
        
	wu[4].setAttribute('onkeydown','resize(this)');
	wu[5].setAttribute('onkeydown','resize(this)');
	
	const btn = document.querySelector('.updateBtn3')
	
	btn.innerHTML='저장';
	btn.removeAttribute("onclick"); // 기존 onclick 제거.
	btn.addEventListener('click',updateWork); // 저장버튼에 수정함수 클릭이벤 도입
	
}



/* 공사 수정 함수 */	

function updateWork() {
	
	plzNum();
	 
	const data = new FormData(document.getElementById('updateForm3'));
	const wu = document.getElementsByClassName('wantUpdate3');
    const btn = document.querySelector('.updateBtn3');
    const wContent= document.querySelector('#sWorkContent');
    		
    		url="/equipment/updateWork"
			fetch(url, {method: 'POST', body : data})
			    .then(res=>res.json())
			    .then(obj=>{
			        console.log(obj);	  
			      
			   // 업데이트 하고자 하는 애들 다시 닫아주기
				 	for (var i = 0; i< wu.length; i++) {			
			            wu[i].readOnly = true;
			            wu[i].required = false;
			        }				 							
					
					btn.innerText='수정';
					btn.removeEventListener('click',updateWork); 
				  	btn.setAttribute('onclick','updateWBtnClick()');
				  	
				  	alert('수정완료!');
				  	location.reload(true);// 새로고침    
	 	})
		.catch((error) => console.log("error:", error));	
	}   	      		

/* 공사 수정 취소 함수 */

function cancelUpdateWork() { // 되감기^^

	console.log("수정 취소버튼 클릭");
	
	const wu = document.getElementsByClassName('wantUpdate3');
	const btn = document.querySelector('.updateBtn3');
	const wContent= document.querySelector('#sWorkContent');
	const wCompany= document.querySelector('#sWorkCompany');
	const wCompanySelect= document.querySelector('#sWorkCompanySelect');
	const wEquipName= document.querySelector('#sWorkEquipName');
	const eqNameSelect3= document.querySelector('#sEquipNameSelect3');
	
	wCompany.style.display='block';
	wCompanySelect.style.display='none';
	wEquipName.style.display='block';
	eqNameSelect3.style.display='none';

						 	
			for (var i = 0; i< wu.length; i++) {
		            wu[i].readOnly =true;
		            wu[i].required = false;
		    }							 	
		wu[4].removeAttribute('onkeydown');
		wu[5].removeAttribute('onkeydown');
			
		btn.innerText='수정';
		btn.removeEventListener('click',updateWork);
		btn.setAttribute('onclick','updateWBtnClick()');
}
// 점검 삭제 하는 함수 
function deleteWork() {

	 // 삭제하는데 사용할 변수 가져오기
	const workNo = document.getElementById('thisWNoUD').value

	const url1="/equipment/deleteWorkNo/"+workNo // 매개변수 번호를 넘겨야됨.
	const url2="/equipment/updateDeleteWorkNo/"+workNo // 매개변수 번호를 넘겨야됨.
				
	const wu = document.getElementsByClassName('wantUpdate3');	 
					
			for (var i = 0; i< wu.length; i++) {
				wu[i].readOnly =true;
				wu[i].required = false;
			  }	
		console.log('삭제 아작스 전송');
		
		fetch(url1,{method: 'delete', headers: {
			 'header' : header,
			 'X-CSRF-Token': token }})
			 .then(res=> res.text())
		     .then(obj=>{
				console.log(obj);
						    	
				fetch(url2,{method: 'post', headers: {
					    'header' : header,
					    'X-CSRF-Token': token,
					    'Content-Type' : 'application/json' }})
						.then(res=> res.text())
						.then(obj=>{
							    	console.log(obj);
									alert('삭제 완료');
									location.reload(true);// 새로고침
							    })  
					 })
		}

	    
/* Date Picker *//* Date Picker *//* Date Picker *//* Date Picker *//* Date Picker *//* Date Picker *//* Date Picker *//* Date Picker *//* Date Picker *//* Date Picker *//* Date Picker *//* Date Picker *//* Date Picker *//* Date Picker */
/* Date Picker *//* Date Picker *//* Date Picker *//* Date Picker *//* Date Picker *//* Date Picker *//* Date Picker *//* Date Picker *//* Date Picker *//* Date Picker *//* Date Picker *//* Date Picker *//* Date Picker *//* Date Picker */

	// const DatePicker = tui.DatePicker; // date picker 선언
	
	// 조회할 때는 picker 또 만들 필요 없습니다!!! => 등록할 때만 
	 	
		const today = new Date();
		//const afterWeek = new Date(today.setDate(today.getDate() + 7));
		//시연할 때 제대로 못보여줄 듯...
	    
		// 변수에 담아서 넣어야 데이터가 보입니다.. 수박
		
		let testPicker = new tui.DatePicker('#t-start-container', {
	    	language: 'ko',
	    		date :today,
	            input: {
	                element: '#t-start-input',
	                format: 'yyyy-MM-dd HH:mm A'
	            },
	            timePicker: {
	                layoutType: 'tab',
	                inputType: 'spinbox'
	          },
	   			selectableRanges: [
                [today, new Date(2999, 11,31)]
            ],
	    });
	
		const before2Weeks = new Date(today.setDate(today.getDate() - 14));
		

    	  let failPicker = new tui.DatePicker('#f-start-container', {
  	    	language: 'ko',  
  	    	date: before2Weeks,
  	            input: {
  	                element: '#f-start-input',
  	                format: 'yyyy-MM-dd HH:mm a'
  	            },
  	            timePicker: {
  	                layoutType: 'tab',
  	                inputType: 'spinbox'
  	          },
  	   		selectableRanges: [
                  [before2Weeks, new Date(2999, 11,31)]
              ],
  	    });
    	
    	
		//const after2Weeks = new Date(today.setDate(today.getDate() + 14));
		//selectableRanges는 이렇게 하면 안먹네요 ㅡㅡ
		
	     let workPicker = new tui.DatePicker.createRangePicker({
	    		language: 'ko',  
	    	    startpicker: {
	    	    	date: new Date(today.setDate(today.getDate() + 14)),
	    	        input: '#w-start-input',
	    	        container: '#w-start-container'	        
		    	    },
		    	    endpicker: {
		    	    	date: new Date(today.setDate(today.getDate() + 14)),
		    	        input: '#w-end-input',
		    	        container: '#w-end-container'   
	    	
	    			},
	    			selectableRanges: [
		                [new Date(today.setDate(today.getDate() + 14)), new Date(2999, 11,31)]
		            ]
	    	        
		    }); 
 
 
let TC = document.querySelector('#sTestContent');
TC.style.height = '8'+`${TC.scrollHeight}`+'px';



function completeChk(){ // 전체, 미완료, 완료 라디오박스
	const ts = document.querySelector('input[name="tStatus0"]:checked').value; //점검 라디오박스
	const ws = document.querySelector('input[name="tStatus2"]:checked').value; //공사 라디오박스
	const usersAuthor = `[[${session.usersAuthor}]]`;
	
///////////////////////////////////////////////////////////////
// 점검
	
		if(ts == '전체'){
			//testGrid.clear();
			//testGrid.refreshLayout();
			
			 url="/equipment/testAllList"
			fetch(url) 
			.then(res=>res.json())
			.then(obj=>{
			    console.log(obj);
			  testGrid.resetData(obj);
			 
			 
		    
			})
		}else if (ts =='미완료'){
			
	/* 점검 미완료 리스트 불러오는 아작스 */
	 		//testGrid.clear();
	 		
			url="/equipment/incompleteTestList"
			fetch(url) 
			.then(res=>res.json())
			.then(obj=>{
			    console.log(obj);
			    testGrid.resetData(obj);
			   
		    
			})
			
		}else if (ts=='완료'){
			
	/* 점검 완료 리스트 불러오는 아작스 */
			//testGrid.clear();
			
			url="/equipment/completeTestList"
			fetch(url) 
			.then(res=>res.json())
			.then(obj=>{
			    console.log(obj);
			    testGrid.resetData(obj);
		    
			})
		}
	
	
///////////////////////////////////////////////////////////////
// 공사

		if(ws == '전체'){
			//testGrid.clear();
			//testGrid.refreshLayout();
			
			 url="/equipment/workAllList"
			fetch(url) 
			.then(res=>res.json())
			.then(obj=>{
			    console.log(obj);
			  workGrid.resetData(obj);
			 
			 
		    
			})
		}else if (ws =='미승인'){
/* 공사 승인 미완료 리스트 불러오는 아작스 */		
			
				if(usersAuthor=='D0108') {
					//설비 팀장이면.. seq=1인것만
			
						url="/equipment/incompleteWork1"
						fetch(url) 
						.then(res=>res.json())
						.then(obj=>{
						    console.log(obj);
						    workGrid.resetData(obj);})
						
				}else if(usersAuthor=='D0106'){
					//생산 팀장이면.. seq=2인것만
					
					url="/equipment/incompleteWork2"
						fetch(url) 
						.then(res=>res.json())
						.then(obj=>{
						    console.log(obj);
						    workGrid.resetData(obj);})
			
				}else if(usersAuthor=='D0111'){
					//생산 팀장이면.. seq=3인것만
					
					url="/equipment/incompleteWork3"
						fetch(url) 
						.then(res=>res.json())
						.then(obj=>{
						    console.log(obj);
						    workGrid.resetData(obj);})	
				}else {
					
					url="/equipment/incompleteWorkList"
						fetch(url) 
						.then(res=>res.json())
						.then(obj=>{
						    console.log(obj);
						    workGrid.resetData(obj);})
					
				}
			
		}else if (ws=='승인완료'){
			
/* 공사 완료 리스트 불러오는 아작스 */
			// seq=3 인것만
			
			url="/equipment/completeWorkList"
			fetch(url) 
			.then(res=>res.json())
			.then(obj=>{
			    console.log(obj);
			    workGrid.resetData(obj);
		    
			})
		}
	}
	
if(`[[${session.usersAuthor}]]`!='D0107'){
	insertWBtn.style.display='none';
}
	
</script>
</div>

</body>
</html>