<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{/layout/layout.html}">
<head>
<meta id="_csrf" name="_csrf" th:content="${_csrf.token}"/>
<meta id="_csrf_header" name="_csrf_header" th:content="${_csrf.headerName}"/>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet" href="https://uicdn.toast.com/tui.time-picker/latest/tui-time-picker.css" />
<script src="https://uicdn.toast.com/tui.time-picker/latest/tui-time-picker.js"></script>
<link rel="stylesheet" href="https://uicdn.toast.com/tui.date-picker/latest/tui-date-picker.css" />
<script src="https://uicdn.toast.com/tui.date-picker/latest/tui-date-picker.js"></script>
	

<!-- style and js -->
<link rel="stylesheet" href="/equipmentCss/main.css"/>

</head>
<body>

	<div layout:fragment="content" style="height: 900px; overflow: scroll; margin:15px;">
			  <h2>설비 유지 관리</h2>
  
		<div> 
            <!-- 탭 목록(버튼) 설정 -->
            <ul class="nav nav-tabs nav-pills" style="padding-top:15px;" id="myTab" role="tablist">
               <li class="nav-item" role="presentation">
                  <button class="nav-link active" id="maintenanceTab"
                     data-bs-toggle="tab" data-bs-target="#maintenance" type="button"
                     role="tab" aria-controls="maintenance" aria-selected="true" >보수</button>
               </li>
               <li class="nav-item" role="presentation">
                  <button class="nav-link" id="workTab" data-bs-toggle="tab"
                     data-bs-target="#work" type="button" role="tab"
                     aria-controls="work" aria-selected="false">공사</button>
               </li>
            </ul>
           
            <!-- 탭 본문 -->
            <div class="tab-content" id="myTabContent">
	               <!-- 보수 탭 -->
	               <div class="tab-pane fade show active" id="maintenance" role="tabpanel"
	                  aria-labelledby="maintenance-tab">
	                  <div style="margin: 15px;">
	                     <table style="width: 100%;">                        
	                           <tr>
	                              <td colspan="3">
	                                 <div class="row">
	                                    <div class="column">
	                                      <h5>점검 내역</h5>                                	
								            <div class="header">
								         	<button type="button" class="btn btn-dark btn-sm margin5"
								         		data-bs-toggle="modal" data-bs-target="#myModal1">등록</button>
								         		<input type="radio" class="radio0" name="tStatus0" checked="checked" onclick="completeChk()" value="전체" style="accent-color :#0000CD;">전체ㅤ
												<input type="radio" class="radio0" name="tStatus0" value="미완료" onclick="completeChk()" style="accent-color : #0000CD;">미완료ㅤ
												<input type="radio" class="radio0" name="tStatus0" value="완료" onclick="completeChk()" style="accent-color :#0000CD;">완료
											     <input onkeyup="filter()" style="float:right;" type="text" 
											     id="value" placeholder="Type to Search">
											 </div>
					      				   			   
	                                       <div id="testGrid">
	                                       </div>
	                                       
	                                    </div>
	                            
	                                    <div class="column">
	                                      <h5>고장 내역</h5>
	                                     	<div class="searchbox">
								            <div class="header">
								         	<button type="button" class="btn btn-dark btn-sm margin5"
								         	data-bs-toggle="modal" data-bs-target="#myModal3">등록</button>
								         		<input type="radio" class="radio1" name="tStatus1" checked="checked" value="미실시" style="accent-color :#0000CD;">전체
												<input type="radio" class="radio1" name="tStatus1" value="진행중" style="accent-color : #0000CD;">미완료
												<input type="radio" class="radio1" name="tStatus1" value="보류" style="accent-color :#0000CD;">완료
											     <input onkeyup="filter()" style="float:right;" type="text" 
											     id="value" placeholder="Type to Search">
											 </div>
					      				   </div>
					      				   
	                                       <div id="failGrid">
	                                       </div>
	                                         
	                                    </div>			        		
	                                 </div>
	                              </td>
	                           </tr>                       
	                     </table>
	
	                  </div>
	
	               </div>
	               
	               <!-- 공사 탭 -->
	               <div class="tab-pane fade" id="work" role="tabpanel"
	                  aria-labelledby="work-tab">
	                  <div>
	                     <table style="width: 100%;">
	                       		<tr>
	                              <td>
	                                 <div style="clear: both; margin: 15px;">  
	                                 	<div style="padding: 30px;">  
	                                      <h5>공사 내역 관리</h5>
	                                      <div class="searchbox">
							              <div class="header">
							         	  <button type="button" class="btn btn-dark btn-sm margin5"
							         	  data-bs-toggle="modal" data-bs-target="#myModal5">등록</button>
										     <input onkeyup="filter()" style="float:right;" 
										     type="text" id="value" placeholder="Type to Search">
										  </div>
				      				      </div>
	                                         
	                                      <div id="workGrid">
	                                      </div>
	                                    </div>			        		
	                                 </div>
	                              </td>
	                           </tr>
	                     </table>
	                  </div>
	               </div>
        </div>
	</div>
	
	<!-- The Modal 1 점검 등록 모달 -->
	<div class="modal fade" id="myModal1">
		<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
	
			<!-- Modal Header -->
			<div class="modal-header">
			<h4 class="modal-title">점검 등록</h4>
			<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
			</div>
	
			<form id="insertForm1" action="insertTest" method="post">
			<!-- <sec:csrfInput/> -->
			<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
			<!-- Modal body -->
			<div class="modal-body">
				<table class="table">
				  	<tr>
						<td>설비명</td>
                        <td>
                        	<input class="form-control" id="testNo" name="testNo" type="hidden" th:value="${tno}">
                        	<input class="form-control" id="testEquipName" name="testEquipName" type="hidden" th:value="${equipFirst.equipName}">
                        	<select class="form-control" id="equipNameSelect1" onchange="changeSelect(this.value,this.id);" required="required" >            							           
								           <option th:each="equip : ${equip}" >[[${equip.equipName}]]</option>
						  	</select>
						</td>    
                    </tr>
                    <tr>
						<td>점검예정일</td>
									<td>
										<div
											class="tui-datepicker-input tui-datetime-input tui-has-focus">
											<input id="t-start-input" type="text" name="testDueDate"
												aria-label="Date"  autocomplete="off"> <span
												class="tui-ico-date"></span>
											<div id="t-start-container" style="margin-left: -1px;"></div>
										</div>
									</td>
								</tr>
                    <tr>
                        <td>점검이유</td>
                        <td><input class="form-control" id="testReason" name="testReason" type="hidden" value="정기점검" required>
                        	<select class="form-control" id="testReasonSelect" onchange="changeSelect(this.value,this.id);" >            
								           <option>정기점검</option>
								           <option>기타</option>
						  	</select></td>    
                   </tr>
                    <tr>
                        <td>점검내용</td>
                        <td><textarea class="form-control " id="testContent" name="testContent" rows="5" readonly="readonly"
                        	onkeydown="resize(this)" style="height :48px;">점검 후 기입 예정</textarea></td>
                    </tr> 
 				
               	 	</table>
			</div>
	
			<!-- Modal footer -->
			<div class="modal-footer">
			<button type="submit" class="btn btn-primary">등록</button>
			<button type="button" class="btn btn-danger" data-bs-dismiss="modal">취소</button>
			</div>
		</form>               
	
		</div>
		</div>
	</div>
	
	<!-- The Modal 2 점검 단건 조회 모달 -->
	<div class="modal fade" id="myModal2" data-backdrop="static" data-keyboard="false">
		
		<div class="modal-dialog modal-dialog-centered" >
			<div class="modal-content">
		
					<!-- Modal Header -->
					<div class="modal-header">
					<h4 class="modal-title"><span id="whatEno"></span>점검 정보</h4>
					<button type="button" onclick="cancelUpdateTest()" class="btn-close" data-bs-dismiss="modal"></button>
					</div>
		
				<form id="updateForm1" class="updateForm" method="post" name="equip">
				<!-- <sec:csrfInput/> -->
				<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
					
					<!-- Modal body -->
					<div id="testInfo" class="modal-body">
						
					
						<table class="table">
		                    <tr>
								<td>설비명</td>
		                        <td><input class="form-control" id="sTestEquipName" name="testEquipName" type="text"  readonly></td> <!-- th:value="${equip.equipName}" -->             
		                    </tr>
		                    <tr>
		                    <td>점검예정일</td>
		                        <td>
		                        	<div class="tui-datepicker-input tui-datetime-input tui-has-focus">
				                    <input id="tv-start-input" class="wantUpdate1" type="text" name="sTestDueDate" 
				                    	aria-label="Date" style="background-color :#E9ECEF;" readonly>
				                    <span class="tui-ico-date"></span>
				                    <div id="tv-start-container" style="margin-left: -1px;"></div>				                   
				                    </div>
		                        </td>		
		                    </tr>
		                     <tr>
		                        <td>점검이유</td>
		                        <td><input class="form-control" id="sTestReason" name="testReason" onkeydown="resize(this)" 
		                       	 	style="height :48px;" autocomplete="off" type="text" readonly></td>
		                     </tr>
		                     <tr>
		                        <td>점검내용</td> <!-- 특이사항 -->
		                        <td><textarea class="form-control wantUpdate1 " id="sTestContent" name="testContent"  onkeydown="resize(this)" 
		                        	style="color:gray; height :48px;" autocomplete="off" rows="5" readonly="readonly">점검 후 기입 예정</textarea></td>
                        	</tr>                  
		                     <tr>
		                        <td>진행상황</td> <!-- 특이사항 -->
		                        <td><input type="radio" class="radio2" name="tCode" checked="checked" value="미실시" style="accent-color :gray;" onclick="return(false);">미실시
									<input type="radio" class="radio2" name="tCode" value="진행중" style="accent-color : gray;" onclick="return(false);">진행중
									<input type="radio" class="radio2" name="tCode" value="보류" style="accent-color :gray;" onclick="return(false);">보류
									<input type="radio" class="radio2" name="tCode" value="점검완료" style="accent-color :gray;" onclick="return(false);">점검완료</td>
                        	</tr>                  
		                </table>
					</div>
		
						<!-- Modal footer -->
						<div class="modal-footer">
							<input id="update"type="hidden" >
							<button type="button"  class="btn btn-primary updateBtn1" onclick="updateTBtnClick()">수정</button>
							<input type="hidden" id="thisNoUD" name="equipNo"> <!-- 업데이트, 삭제 때문에 가져온 설비번호 값. -->
							<button type="button" onclick="deleteEquip()" class="btn btn-primary">삭제</button>
							<button type="button"  onclick="cancelUpdateTest()"  class="btn btn-danger" data-bs-dismiss="modal">닫기</button>
						</div>
				</form>
		
			</div>
		</div>
	</div>
	
		
	<!-- The Modal 3 고장 등록 모달 -->
	<div class="modal fade" id="myModal3">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
		
				<!-- Modal Header -->
				<div class="modal-header">
				<h4 class="modal-title">고장 등록</h4>
				<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>
		
				<form id="insertForm2" action="insertFail" method="post">
				<!-- <sec:csrfInput/> -->
				<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
				<!-- Modal body -->
				<div class="modal-body"> 
					<table class="table">	
	                    <tr>
	                        <td>설비명</td>
                        	<td>
	                        	<input class="form-control" id="failNo" name="failNo" type="hidden" th:value="${fno}">
	                        	<input class="form-control" id="failEquipName" name="failEquipName" type="hidden" th:value="${equipFirst.equipName}" >
	                        	<select class="form-control" id="equipNameSelect2" onchange="changeSelect(this.value,this.id);" required="required" >            							           
									           <option th:each="equip : ${equip}" >[[${equip.equipName}]]</option>
							  	</select>
							</td>    
	                    </tr>
	                    <tr>
		                    <td>고장발생일</td>
		                        <td>
		                        	<div class="tui-datepicker-input tui-datetime-input tui-has-focus">
				                    <input id="f-start-input" type="text" name="failDate" aria-label="Date" >
				                    <span class="tui-ico-date"></span>
				                    <div id="f-start-container" style="margin-left: -1px;"></div>
				                    </div>
		                        </td>		
		                    </tr>
	                    <tr>
	                        <td>고장내역</td>
	                        <td><textarea class="form-control textWidth resizeInsertForm" id="failContent" onkeydown="resize(this)" name="failContent" rows="5"></textarea></td>
	                    </tr>    
                        <tr>
	                        <td>수리내역</td>  
							<td><textarea class="form-control resizeInsertForm" id="failRepairContent" name="failRepairContent" rows="5"
							 	onkeydown="resize(this)" readonly="readonly"
                        		style="color:gray;">수리 후 기입 예정</textarea>
                        	</td>
                        </tr>                 
	                </table>
				</div>
		
				<!-- Modal footer -->
					<div class="modal-footer">
						<button type="submit" class="btn btn-primary">등록</button>
						<button type="button" class="btn btn-danger"  data-bs-dismiss="modal">닫기</button>
					</div>
			</form>
		
			</div>
		</div>
	</div>
	
	<!-- The Modal 4 고장 단건 조회 모달 -->
	<div class="modal fade" id="myModal4" data-backdrop="static" data-keyboard="false">
		
		<div class="modal-dialog modal-dialog-centered" >
			<div class="modal-content">
		
					<!-- Modal Header -->
					<div class="modal-header">
					<h4 class="modal-title"><span id="whatEno"></span>고장 정보</h4>
					<button type="button" onclick="cancelUpdateFail()" class="btn-close" data-bs-dismiss="modal"></button>
					</div>
		
				<form id="updateForm1" class="updateForm" method="post" name="equip">
				<!-- <sec:csrfInput/> -->
				<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
					
					<!-- Modal body -->
					<div id="failInfo" class="modal-body">
						
					
						<table class="table">
		                    <tr>
								<td>설비명</td>
		                        <td><input class="form-control" id="sFailEquipName" name="testEquipName" type="text"  readonly></td> <!-- th:value="${equip.equipName}" -->             
		                    </tr>
		                    <tr>
		                    <td>고장발생일</td>
		                        <td>
		                        	<div class="tui-datepicker-input tui-datetime-input tui-has-focus">
				                    <input id="fv-start-input" class="wantUpdate" type="text" name="failDate" aria-label="Date" style="background-color :#E9ECEF;" readonly>
				                    <span class="tui-ico-date"></span>
				                    <div id="fv-start-container" style="margin-left: -1px;"></div>
				                    </div>
		                        </td>		
		                    </tr>
		                     <tr>
		                        <td>고장내역</td>
		                        <td><input class="form-control wantUpdate "  id="sFailContent" name="failContent" type="text" readonly></td>
		                     </tr>
		                    <tr>
		                        <td>수리내역</td>
								<td><textarea class="form-control wantUpdate resizeInsertForm" id="sfailRepairContent" name="failRepairContent" rows="5"
								 	onkeydown="resize(this)" readonly="readonly"
	                        		style="color:gray; height :1px;">수리 후 기입 예정</textarea>
	                        	</td>
	                        </tr>                
		                     <tr>
		                        <td>진행상황</td> <!-- 특이사항 -->
		                        <td><input type="radio" name="failCode" value="미실시" checked="checked" style="accent-color :gray;" onclick="return(false);">미실시
									<input type="radio" name="failCode" value="진행중" style="accent-color : gray;" onclick="return(false);">진행중
									<input type="radio" name="failCode" value="보류" style="accent-color :gray;" onclick="return(false);">보류
									<input type="radio" name="failCode" value="점검완료" style="accent-color :gray;" onclick="return(false);">수리완료</td>
                        	</tr>                  
		                </table>
					</div>
		
						<!-- Modal footer -->
						<div class="modal-footer">
							<input id="update"type="hidden" >
							<button type="button"  class="btn btn-primary updateBtn" onclick="updateBtnClick()">점검</button>
							<input type="hidden" id="thisNoUD" name="equipNo"> <!-- 업데이트, 삭제 때문에 가져온 설비번호 값. -->
							<button type="button" onclick="deleteEquip()" class="btn btn-primary">삭제</button>
							<button type="button"  onclick="cancelUpdateEquip()"  class="btn btn-danger" data-bs-dismiss="modal">닫기</button>
						</div>
				</form>
		
			</div>
		</div>
	</div>
	
	
	<!-- The Modal 5 공사 등록 모달 -->
	<div class="modal fade" id="myModal5">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
		
				<!-- Modal Header -->
				<div class="modal-header">
				<h4 class="modal-title">공사 품의 등록</h4>
				<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>
		
				<form id="insertForm3" action="insertWork" method="post" onsubmit="return plzNum()">
				<!-- <sec:csrfInput/> -->
				<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
				<!-- Modal body -->
				<div class="modal-body"> 
					<table class="emp">
						<tr class="emp">
							<td>설비사원</td>
							<td>설비팀장</td>
							<td>생산팀장</td>
							<td>공장장님</td>
						</tr>
						<tr class="emp">
							<td><img src="/equipmentCss/홍길동인.PNG"></td> <!-- 본인 도장 사진으로 대체 -->
							<td></td>
							<td></td>
							<td></td>
						</tr>
					</table>
					
					<br>
					<table class="table">	
	                    <tr>
	                        <td>공사명</td>
                        	<td><input class="form-control" id="workName" name="workName" autocomplete="off" type="text"></td>	  
	                    </tr>
	                    <tr>
	                    	<td>설비명</td> 
	                    	<td>
	                        	<input class="form-control" id="workNo" 
	                        			name="workNo" type="hidden" th:value="${wno}"> <!-- 공사번호 -->		
	                        	<input class="form-control" id="usersId" 
	                        			name="usersId" type="hidden" th:value="${session.usersId}"> <!-- 회원ID값 -->		
	                        	<input class="form-control" id="workEquipName"
	                        			name="workEquipName" type="hidden" th:value="${equipFirst.equipName}" >		
	                        	<select class="form-control" id="equipNameSelect3" onchange="changeSelect(this.value,this.id);" required="required" >            							           
									           <option th:each="equip : ${equip}" >[[${equip.equipName}]]</option>
							  	</select>
							</td>
	                    </tr>
	                      <tr>
	                        <td>시공일정</td>  
							<td>
							 	  <div class="tui-datepicker-input tui-datetime-input tui-has-focus">
				                  <input id="w-start-input" name="workDate" autocomplete="off" type="text" aria-label="Date">
				                  <span class="tui-ico-date"></span>
				                  <div id="w-start-container" style="margin-left: -1px;"></div>
				               	  </div>
				               <span>-</span>
				               <div class="tui-datepicker-input tui-datetime-input tui-has-focus">
				                  <input id="w-end-input" name="workEndDate" autocomplete="off" type="text" aria-label="Date">
				                  <span class="tui-ico-date"></span>
				                  <div id="w-end-container" style="margin-left: -1px;"></div>
				               </div>
							</td>	                     
                        </tr>
	                    <tr>
	                        <td>공사내용</td>
	                        <td><textarea class="form-control" id="workContent" name="workContent"  placeholder="입력하세요.." 
	                        	onkeydown="resize(this)" style="height :48px;" autocomplete="off" rows="5"></textarea></td> 
	                    </tr>
	                    <tr>
	                    	<td>특이사항</td>
	                        <td><textarea class="form-control" id="workPs" name="workPs"  placeholder="입력하세요.." 
	                        	onkeydown="resize(this)" style="height :48px;" autocomplete="off" rows="5"></textarea></td>
	                    </tr>
	                    <tr>
	                        <td>공사업체</td>
	                        <td><input class="form-control" id="workCompany" name="workCompany" type="hidden" value="(주)퐁퐁건설" required>
	                        	<select class="form-control" id="workCompanySelect" onchange="changeSelect(this.value,this.id);" >            
									           <option>(주)퐁퐁건설</option>
									           <option>(주)예담건설</option>
									           <option>(주)대구건설</option>
							  	</select>
							</td>
                  		</tr>
                        <tr>
	                        <td>공사비용</td>  
							<td><input class="form-control" id="workPay" name="workPay" type="number" required></td>
                        </tr>      
                           
	                </table>
	                
	                
				</div>
		
				<!-- Modal footer -->
					<div class="modal-footer">
						<button type="submit" class="btn btn-primary">등록</button>
						<button type="button" class="btn btn-danger"  data-bs-dismiss="modal">닫기</button>
					</div>
			</form>
		
			</div>
		</div>
	</div>

	<!-- The Modal 6 공사 단건 조회 모달 -->
	<div class="modal fade" id="myModal6" data-backdrop="static" data-keyboard="false">
		
		<div class="modal-dialog modal-dialog-centered" >
			<div class="modal-content">
		
					<!-- Modal Header -->
					<div class="modal-header">
					<h4 class="modal-title">공사 정보</h4>
					<button type="button" onclick="cancelUpdateWork()" class="btn-close" data-bs-dismiss="modal"></button>
					</div>
		
				<form id="updateForm1" class="updateForm" method="post" name="equip">
				<!-- <sec:csrfInput/> -->
				<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
					
					<!-- Modal body -->
					<div id="workInfo" class="modal-body">
							<div class="modal-body" style="padding: 0.3rem;"> 
					<table class="emp" >
						<tr class="emp">
							<td>설비사원</td>
							<td>설비팀장</td>
							<td>생산팀장</td>
							<td>공장장님</td>
						</tr>
						<tr class="emp">
							<td><img src="/equipmentCss/홍길동인.PNG"></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
					</table>
					<button type="button"  class="btn btn-primary updateBtn" style="float:right;" onclick="updateBtnClick()">승인</button>
					<br>
					
						<table class="table">
		                    <tr>
								<td>공사명</td>
		                        <td><input class="form-control" id="sWorkName" name="workName" type="text"  readonly></td> <!-- th:value="${equip.equipName}" -->             
		                    </tr>
		                    <tr>
								<td>설비명</td>
		                        <td><input class="form-control" id="sWorkEquipName" name="workEquipName" type="text"  readonly></td> <!-- th:value="${equip.equipName}" -->             
		                    </tr>
		                   	<tr>
	                        	<td>시공일정</td>  
								<td>
								 	  <div class="tui-datepicker-input tui-datetime-input tui-has-focus">
					                  <input id="wv-start-input" name="workDate" autocomplete="off" type="text" aria-label="Date" 
					                  		style="background-color :#E9ECEF;" readonly>
					                  <span class="tui-ico-date" ></span>
					                  <div id="wv-start-container" style="margin-left: -1px;"></div>
					               	  </div>
					               <span>-</span>
					               <div class="tui-datepicker-input tui-datetime-input tui-has-focus">
					                  <input id="wv-end-input" name="workEndDate" autocomplete="off" type="text" aria-label="Date" 
					                  		style="background-color :#E9ECEF;" readonly>
					                  <span class="tui-ico-date"></span>
					                  <div id="wv-end-container" style="margin-left: -1px;"></div>
					               </div>
								</td>
							</tr>
							
							 <tr>
		                        <td>공사내역</td>
		                        <td><input class="form-control wantUpdate " onkeydown="resize(this)" 
		                        		style=" height :48px;" id="sWorkContent" name="workContent" type="text" readonly></td>
		                     </tr>

							 <tr>
		                        <td>특이사항</td>
								<td><textarea class="form-control wantUpdate " id="sWorkPs" name="workPs" rows="5"
								 	onkeydown="resize(this)" style="height :48px;" readonly="readonly"></textarea>
	                        	</td>
	                        </tr>

							 <tr>
		                        <td>공사업체</td>
		                        <td><input class="form-control wantUpdate"  id="sWorkCompany" name="workCompany" type="text" readonly></td>
		                     </tr>
		                     
		                     <tr>
		                        <td>예상비용</td>
		                        <td><input class="form-control wantUpdate"  id="sWorkPay" name="workPay" type="text" readonly></td>
		                     </tr>
		                                      
		                </table>
					</div>
					</div>
		
						<!-- Modal footer -->
						<div class="modal-footer">
							<button type="button"  class="btn btn-primary updateBtn" onclick="updateBtnClick()">수정</button> <!--  -->
							
							<input type="hidden" id="thisSeqUD" name="signSeq"> <!-- 결재순서 업데이트 때문에 가져온 값. -->
							<input type="hidden" id="thisNoUD" name="workEquipNo"> <!-- 업데이트, 삭제 때문에 가져온 설비번호 값. -->
							<button type="button" onclick="deleteEquip()" class="btn btn-primary">삭제</button>
							<button type="button"  onclick="cancelUpdateEquip()"  class="btn btn-danger" data-bs-dismiss="modal">닫기</button>
						</div>
				
				</form>
				
			</div>
		</div>
	</div>

<script type="text/javascript">
/* JAVASCRIPT *//* JAVASCRIPT *//* JAVASCRIPT *//* JAVASCRIPT *//* JAVASCRIPT *//* JAVASCRIPT *//* JAVASCRIPT *//* JAVASCRIPT *//* JAVASCRIPT *//* JAVASCRIPT *//* JAVASCRIPT */
/* JAVASCRIPT *//* JAVASCRIPT *//* JAVASCRIPT *//* JAVASCRIPT *//* JAVASCRIPT *//* JAVASCRIPT *//* JAVASCRIPT *//* JAVASCRIPT *//* JAVASCRIPT *//* JAVASCRIPT *//* JAVASCRIPT */	

/* 숫자만 적으세요 그리고 음수는 안돼요 함수 미사용중 */

function plzNum(){
	let tag = document.getElementById('workPay');
	
	if(tag.value < 0){	
		alert('금액을 제대로 입력해주세요.');
		return false;
	}
	
	//다 만족하면 true
	return true;
	
	document.getElementById('insertForm3').submit();
}

/* textarea_자동_높이_조절 함수 */
function resize(obj) {
  obj.style.height = "1px";
  obj.style.height = (12+obj.scrollHeight)+"px";
}


/* 점검할 또는 고장난 또는 공사할 설비명 선택하게 하는 함수 */ 
	function changeSelect(val,id) { 
		let tag = document.getElementById(id);
		console.log(tag.previousElementSibling.id);	
		tag.previousElementSibling.value = val;
	}
	
/* 점검할 또는 고장난 또는 공사할 설비명 디폴트값 미사용중 */ 
function test (id){
	let tag = document.querySelector(id);
	tag.value = tag.nextSibling.firstChild.innerText;
}

	
/*------------
   // 탭 버튼 클릭
   ----------------*/
	const mt = document.querySelector('#maintenanceTab');
  	mt.addEventListener('shown.bs.tab',function(){ // 탭과 관련되어있어서
	   testGrid.refreshLayout();
 	  	failGrid.refreshLayout();
	});
	
	const wt = document.querySelector('#workTab');
	wt.addEventListener('shown.bs.tab',function(){
	   workGrid.refreshLayout();
 	  	
	});
   

/*  점검 그리드  */	
	const testGrid = new tui.Grid({
			    el: document.querySelector('#testGrid'),
			    pagination:true,
				pageOptions: {
					useClient: true,
					perPage: 4
				},
			    columns: [
			    {
					header:'점검번호',
					name:'testNo'
					,align : 'center'
				},
			    {
			        header: '설비명',
			        name: 'testEquipName'
			        ,align : 'center'
			    },
			    {
			        header: '점검예정일',
			        name: 'testDueDate'
			        ,align : 'center'
			    },
			    {
			        header: '점검사유',
			        name: 'testReason'
			        ,align : 'center'
			    },
			    {
			        header: '점검내역',
			        name: 'testContent'
			        ,align : 'center'
			    },
			    {
			        header: '진행상황',
			        name: 'testCode'
			        ,align : 'center'
			    }
			    ]
			});

/* 점검 전체 리스트 불러오는 아작스 */

	 url="/equipment/testAllList"
	fetch(url) 
	.then(res=>res.json())
	.then(obj=>{
	    console.log(obj);
	  testGrid.resetData(obj);
	})	
	
function completeChk(){ // 전체, 미완료, 완료 라디오박스
const ts = document.querySelector('input[name="tStatus0"]:checked').value
	
	if(ts == '전체'){
		//testGrid.clear();
		//testGrid.refreshLayout();
		
		 url="/equipment/testAllList"
		fetch(url) 
		.then(res=>res.json())
		.then(obj=>{
		    console.log(obj);
		  testGrid.resetData(obj);
		 
		 
	    
		})
	}else if (ts =='미완료'){
/* 점검 미완료 리스트 불러오는 아작스 */
 		//testGrid.clear();
 		
		url="/equipment/incompleteTestList"
		fetch(url) 
		.then(res=>res.json())
		.then(obj=>{
		    console.log(obj);
		    testGrid.resetData(obj);
		   
	    
		})
		
	}else if (ts=='완료'){	
/* 점검 완료 리스트 불러오는 아작스 */
		//testGrid.clear();
		
		url="/equipment/completeTestList"
		fetch(url) 
		.then(res=>res.json())
		.then(obj=>{
		    console.log(obj);
		    testGrid.resetData(obj);
	    
		})
	}
}
	
	

/*  점검 단건조회 불러오는 아작스 함수 */

	function getTestNo(testNo,testEquipNo) {
			
		    url="/equipment/getTestInfo?testNo="+testNo+"&testEquipNo="+testEquipNo // get방식이라 ?equipNo=
		    fetch(url) 
		    .then(res=>res.json())
		    .then(obj=>{
		        console.log(obj);
		        console.log(obj.testDueDate);
		        console.log(obj.testEquipName);
				document.querySelector('#sTestEquipName').value=obj.testEquipName;
				document.querySelector('#tv-start-input').value=obj.testDueDate;
		        document.querySelector('#sTestReason').value=obj.testReason; 
		       		       
		    })
	    
		}

	
/* 점검 그리드 셀 클릭-> 모달 팝업 이벤트 */
		 
	    testGrid.on('click', ev => {
	    	const tnoRow = testGrid.getRow(ev.rowKey); // 행 (객체)
	    	const tno = tnoRow.testNo; // 행의 점검번호
	    	const eno = tnoRow.testEquipNo; // 행의 설비번호
	    	console.log(tno);
	   	/* if(equip.getValue(ev.rowKey,ev.columnName) == equipInfo)) */
	    	console.log(ev);
	    	
	    	if(ev.rowKey == tnoRow.rowKey){
				if(tno != null){
		    	const myModal2 = new bootstrap.Modal('#myModal2',{backdrop: 'static',keyboard:false})
		    	// 생성 시 모달 속성을 넣어줍니다.
		    	const modalToggle2 = document.getElementById('myModal2'); 
		    	
				getTestNo(tno,eno);
		    	myModal2.show(modalToggle2);
		    	
				}
	    	}
		});

		

/* 점검 수정 버튼 누른 함수 */
			function updateTBtnClick() {
				
				console.log("점검 수정 버튼 클릭");
				const wu = document.getElementsByClassName('wantUpdate1');	 // 점검1 고장2 공사3
				for (var i = 0; i< wu.length; i++) {
		            wu[i].readOnly = false;
		            wu[i].required = true;
		        }
		        
				const tContent= document.querySelector('#sTestContent');
						
				if(tContent.value=='점검 후 기입 예정'){
							tContent.innerText=''; // 기존의 예시내용 제거
						}
					tContent.style.color='black'; // 새로작성할 점검내역 글씨색 검정색

				const radio = document.getElementsByClassName('radio2');	// 배열
					console.log(radio);
					
					for (var i = 0; i< radio.length; i++) {
						radio[i].removeAttribute("onclick"); // 온클릭 false 해제 => 선택가능
						radio[i].style.accentColor='#0000CD';
			        }
				/// datepicker
				
				
				/*const afterWeek = new Date(today.setDate(today.getDate() + 7));
				wu[0].style.backgroundColor='white'; datepicker
				let testUpdatePicker = new tui.DatePicker('#tv-start-container', {
				    	language: 'en',
				    		date :afterWeek,
				            input: {
				                element: '#tv-start-input',
				                format: 'yyyy-MM-dd HH:mm A'
				            },
				            timePicker: {
				                layoutType: 'tab',
				                inputType: 'spinbox'
				          },
				   			selectableRanges: [
			                [afterWeek, new Date(2999, 11,31)]
			            ],
				    });*/
				
				
				const tCode = document.querySelector('input[name="tCode"]:checked').value;
				console.log(tCode);
				const btn = document.querySelector('.updateBtn1')
				btn.innerHTML='저장';
				
				
	
				
				btn.addEventListener('click',updateTest);
				
				
	
			}

/* 점검 수정 함수 */	
			
		function updateTest() {
	
				const url1="/equipment/updateTest1";
				const url2="/equipment/updateTest2";
				const data = new FormData(document.getElementById('updateForm1'));
				const wu = document.getElementsByClassName('wantUpdate1');
			    const btn = document.querySelector('.updateBtn1');
			    const tCode = document.querySelector('input[name="tCode"]:checked');
			    const radio = document.getElementsByClassName('radio2');	
			    	

				if(tCode.value == '점검완료'){
						
						if(confirm('점검완료 처리하시겠습니까? 수정이 불가능 합니다.')){
								// 네 -> 점검 완료 수정불가 상태
								//최종점검완료 아작스 
								console.log("최종수정 아작스 전송");
								
								tCode.setAttribute('name','testCode'); // DB에 보낼 라디오 name값
								
								 fetch(url1, {method: 'POST', body : data})
								    .then(res=>res.json())
								    .then(obj=>{
								        console.log(obj);
								    // 업데이트 하고자 하는 애들  닫아주기
									 	for (var i = 0; i< wu.length; i++) {
									 		
								            wu[i].readOnly =true;
								            wu[i].required = false;
								        }
									 // wu[0].style.backgroundColor='#E9ECEF';
										 
					    			btn.setAttribute('type', 'hidden'); //수정 이제 못하도록 안보이게
									btn.removeEventListener('click',updateTest);
									btn.setAttribute('onclick','updateTBtnClick()');
								  	alert('점검완료!');
									
								  	location.reload(true);// 새로고침			   
								    
									})
									.catch((error) => console.log("error:", error));
							}else {
								
								for (var i = 0; i< radio.length; i++) {
									
										radio[i].checked=false; //체크되어있는 항목 모두 해제		
						        	}
								
										radio[3].checked = true; // 그대로 점검완료에 checked
								}
					
				} else { // 아니오
							 //단순 수정아작스 	
						
						console.log("단순수정 아작스 전송");
						tCode.setAttribute('name','testCode'); // DB에 보낼 라디오 name값
						 fetch(url2, {method: 'POST', body : data})
						    .then(res=>res.json())
						    .then(obj=>{
						        console.log(obj);
						        
						        // 업데이트 하고자 하는 애들 닫아주기
							 	for (var i = 0; i< wu.length; i++) {
							 		
						            wu[i].readOnly =true;
						            wu[i].required = false;
    
						        }
							 // wu[0].style.backgroundColor='#E9ECEF';
							 
								btn.innerText='수정';
								btn.removeEventListener('click',updateTest);
								btn.setAttribute('onclick','updateTBtnClick()');
								
								for (var i = 0; i< radio.length; i++) {		
									radio[i].setAttribute('name','tCode'); // 모든 radio 네임값 초기화
						        }
								
							  	alert('수정완료!');					
							  	location.reload(true);// 새로고침
					 
						    
				 	})
					.catch((error) => console.log("error:", error));
					
				}   
				      		
			}
	
			
			
/* 점검 수정 취소 함수 */
			
			function cancelUpdateTest() { // 되감기^^
	
				console.log("수정 취소버튼 클릭");
				
				const wu = document.getElementsByClassName('wantUpdate1');
				const btn = document.querySelector('.updateBtn1');
				const tContent= document.querySelector('#sTestContent');
				
					for (var i = 0; i< wu.length; i++) {
			            wu[i].readOnly =true;
			            wu[i].required = false;
			        }
					 	wu[0].style.backgroundColor='#E9ECEF';
					 
 	
					tContent.style.color='gray';
					tContent.value='점검 후 기입예정'; // textArea는 value를 써야하구나 
					
					const radio = document.getElementsByClassName('radio2');
						// 배열
					for (var i = 0; i< radio.length; i++) {
						
							radio[i].setAttribute("onclick","return false"); // 온클릭 false 해제 => 선택가능
							radio[i].style.accentColor='gray';	   
							radio[i].checked=false; //체크되어있는 항목 모두 해제		
				        }
						
					radio[0].checked = true; // 첫 번째만 checked
					
					btn.innerText='수정';
					btn.removeEventListener('click',updateTest);
				
			}
			

	

/*  점검 삭제 하는 함수 
			
			function deleteProcess() {

				const processNo = document.getElementById('thisNoUD2').value
				
			// 먼저, 공정이 현재 설비에서 사용 중인지 체크 => 사용 중이면 삭제 불가능!!
				
			     var use = 0; // 초기값 0, 사용 중이라면 1
			     const ep = document.getElementsByClassName('equipProcess');	 
				 	
			     for (var i = 0; i< ep.length; i++) {
			       if(ep[i].value == processNo){
			            	
			        use = 1; // 하나라도 일치하는 게 있으면 1로 변함.
			            }   
			        }
				
			   	if(use == 0){
					const header = document.querySelector('meta[name="_csrf_header"]').content;
					const token = document.querySelector('meta[name="_csrf"]').content;
					    //get을 제외한 모든 방식은 토큰을 필요로 한다.
					    
					console.log(processNo);
					const url1="/equipment/deleteProcess/"+processNo // 매개변수 번호를 넘겨야됨.
					const url2="/equipment/updateDeleteProcessNo/"+processNo // 매개변수 번호를 넘겨야됨.
				
					const wantUpdate = document.getElementsByClassName('wantUpdate');	 
					
					for (var i = 0; i< wantUpdate.length; i++) {
			            wantUpdate[i].readOnly =true;
			            wantUpdate[i].required = false;
			        }	
					
					fetch(url1,{method: 'delete', headers: {
			                'header' : header,
					    	'X-CSRF-Token': token }})
						    .then(res=> res.text())
						    .then(obj=>{
						    	console.log(obj);
						    	
						    	fetch(url2,{method: 'post', headers: {
					                'header' : header,
							    	'X-CSRF-Token': token,
							    	'Content-Type' : 'application/json' }})
								    .then(res=> res.text())
								    .then(obj=>{
							    	console.log(obj);
									alert('삭제 완료');
									location.reload(true);// 새로고침
							    })  
					 })
			     } else if (use == 1){
			    	alert('현재 사용 중인 공정입니다.');
			     }
			    	
			}   */

		 
//============================================================================================================================================================		
			
	
/*  고장 그리드  */	
		const failGrid = new tui.Grid({
		    el: document.querySelector('#failGrid'),
		    pagination:true,
			pageOptions: {
				useClient: true,
				perPage: 4
			},
		    columns: [
		    {
				header:'고장번호',
				name:'failNo'
				,align : 'center'
			},
		    {
		        header: '설비명',
		        name: 'failEquipName'
		        ,align : 'center'
		    },
		    {
		        header: '고장발생일',
		        name: 'failDate'
		        ,align : 'center'
		    },
		    {
		        header: '고장내역',
		        name: 'failContent'
		        ,align : 'center'
		    },
		    {
		        header: '수리내역',
		        name: 'failRepairContent'
		        ,align : 'center'
		    },
		    {
		        header: '진행상황',
		        name: 'failCode'
		        ,align : 'center'
		    }
		    ]
		});
		
/* 고장 리스트 불러오는 아작스 */
	    
	    url="/equipment/failList"
	    fetch(url) 
	    .then(res=>res.json())
	    .then(obj=>{
	        console.log(obj);
	        failGrid.resetData(obj);
	        
	    })

/* 고장 그리드 셀 클릭-> 모달 팝업 이벤트 */
		 
	    failGrid.on('click', ev => {
	    	const fnoRow = failGrid.getRow(ev.rowKey); // 행 (객체)
	    	const fno = fnoRow.failNo; // 행의 점검번호
	    	const eno = fnoRow.failEquipNo; // 행의 설비번호
	    	console.log(fno);
	   	/* if(equip.getValue(ev.rowKey,ev.columnName) == equipInfo)) */
	    	console.log(ev);
	    	
	    	if(ev.rowKey == fnoRow.rowKey){
				if(fno != null){
		    	const myModal4 = new bootstrap.Modal('#myModal4',{backdrop: 'static',keyboard:false})
		    	// 생성 시 모달 속성을 넣어줍니다.
		    	const modalToggle4 = document.getElementById('myModal4'); 
		    	
				getFailNo(fno,eno);
		    	myModal4.show(modalToggle4);
		    	
				}
	    	}
		});
		
/*  고장 단건조회 불러오는 아작스 함수 */

		function getFailNo(failNo,failEquipNo) {
				
			    url="/equipment/getFailInfo?failNo="+failNo+"&failEquipNo="+failEquipNo // get방식이라 ?equipNo=
			    fetch(url) 
			    .then(res=>res.json())
			    .then(obj=>{
			        console.log(obj);
    
					document.querySelector('#sFailEquipName').value=obj.failEquipName;
					document.querySelector('#fv-start-input').value=obj.failDate;
			        document.querySelector('#sFailContent').value=obj.failContent;
			       
			    })
		    
			}	    


//============================================================================================================================================================		




/*  공사 그리드  */	
		
		const workGrid = new tui.Grid({
		    el: document.querySelector('#workGrid'),
		    pagination:true,
			pageOptions: {
				useClient: true,
				perPage: 4
			},
		    columns: [
		    {
			   	header:'공사번호',
			    name:'workNo'
			    ,align : 'center'
			},
		    {
		        header: '공사명',
		        name: 'workName'
		        ,align : 'center'
		    },
		    {
		        header: '시공예정일',
		        name: 'workDate'
		        ,align : 'center'
		    },
		    {
		        header: '공사비용',
		        name: 'workPay'
		        ,align : 'right'
		        ,formatter: function(value) {
		        	
	                return value.value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',')+' 원'; // 3자리 마다 
	            }
		    },
		    {
		        header: '결재정보',
		        name: 'signCode'
		        ,align : 'center'
		    },
		    {
		        header: '진행상황',
		        name: 'workCode'
		        ,align : 'center'
		    }
		    ]
		});

	

/* 공사 리스트 불러오는 아작스 */
	    
	    url="/equipment/workList"
	    fetch(url) 
	    .then(res=>res.json())
	    .then(obj=>{
	        console.log(obj);
	        workGrid.resetData(obj);
	        
	    })
	    
/* 공사 그리드 셀 클릭-> 모달 팝업 이벤트 */
		 
	    workGrid.on('click', ev => {
	    	const wnoRow = workGrid.getRow(ev.rowKey); // 행 (객체)
	    	const wno = wnoRow.workNo; // 행의 공사번호
	    	const eno = wnoRow.workEquipNo; // 행의 설비번호
	    	console.log(wno);
	   	/* if(equip.getValue(ev.rowKey,ev.columnName) == equipInfo)) */
	    	console.log(ev);
	    	
	    	if(ev.rowKey == wnoRow.rowKey){
				if(wno != null){
		    	const myModal6 = new bootstrap.Modal('#myModal6',{backdrop: 'static',keyboard:false})
		    	// 생성 시 모달 속성을 넣어줍니다.
		    	const modalToggle6 = document.getElementById('myModal6'); 
		    	
				getWorkNo(wno,eno);
		    	myModal6.show(modalToggle6);
		    	
				}
	    	}
		});
		
/*  공사 단건조회 불러오는 아작스 함수 */

function getWorkNo(workNo,workEquipNo) {
				
			    url="/equipment/getWorkInfo?workNo="+workNo+"&workEquipNo="+workEquipNo // get방식이라 ?equipNo=
			    fetch(url) 
			    .then(res=>res.json())
			    .then(obj=>{
			        console.log(obj);
    
					document.querySelector('#sWorkName').value=obj.workName;
					document.querySelector('#sWorkEquipName').value=obj.workEquipName;
					document.querySelector('#sWorkPs').value=obj.workPs;
					document.querySelector('#sWorkPay').value=obj.workPay;
					document.querySelector('#sWorkCompany').value=obj.workCompany;
					document.querySelector('#wv-start-input').value=obj.workDate;
					document.querySelector('#wv-end-input').value=obj.workEndDate;
			        document.querySelector('#sWorkContent').value=obj.workContent;
			       
			    })
		    
}		    

	    
	/* Date Picker */

	// const DatePicker = tui.DatePicker; // date picker 선언
	
	// 조회할 때는 picker 또 만들 필요 없습니다!!! => 등록할 때만 
	 	
		const today = new Date();
		const afterWeek = new Date(today.setDate(today.getDate() + 7));
	    
		// 변수에 담아서 넣어야 데이터가 보입니다.. ㅅㅂ
		
		let testPicker = new tui.DatePicker('#t-start-container', {
	    	language: 'ko',
	    		date :afterWeek,
	            input: {
	                element: '#t-start-input',
	                format: 'yyyy-MM-dd HH:mm A'
	            },
	            timePicker: {
	                layoutType: 'tab',
	                inputType: 'spinbox'
	          },
	   			selectableRanges: [
                [afterWeek, new Date(2999, 11,31)]
            ],
	    });
	
	       
        
/*     	let testViewPicker = new DatePicker.createRangePicker('#tv-start-container',{
    	    startpicker: {
    	    	date: today,
    	    	input: {
	    	        element: '#tv-start-input',    	       
	    	    }
    	        
    	    }
    	   
    	}); */
    	
	
		const before2Weeks = new Date(today.setDate(today.getDate() - 14));
		

    	  let failPicker = new tui.DatePicker('#f-start-container', {
  	    	language: 'ko',  
  	    	date: before2Weeks,
  	            input: {
  	                element: '#f-start-input',
  	                format: 'yyyy-MM-dd HH:mm a'
  	            },
  	            timePicker: {
  	                layoutType: 'tab',
  	                inputType: 'spinbox'
  	          },
  	   		selectableRanges: [
                  [before2Weeks, new Date(2999, 11,31)]
              ],
  	    });
    	
    	
		//const after2Weeks = new Date(today.setDate(today.getDate() + 14));
		//selectableRanges는 이렇게 하면 안먹네요 ㅡㅡ
		
	     let workPicker = new tui.DatePicker.createRangePicker({
	    		language: 'ko',  
	    	    startpicker: {
	    	    	date: new Date(today.setDate(today.getDate() + 14)),
	    	        input: '#w-start-input',
	    	        container: '#w-start-container'	        
		    	    },
		    	    endpicker: {
		    	    	date: new Date(today.setDate(today.getDate() + 14)),
		    	        input: '#w-end-input',
		    	        container: '#w-end-container'   
	    	
	    			},
	    			selectableRanges: [
		                [new Date(today.setDate(today.getDate() + 14)), new Date(2999, 11,31)]
		            ]
	    	        
		    }); 
 
 

    



</script>
</div>

</body>
</html>