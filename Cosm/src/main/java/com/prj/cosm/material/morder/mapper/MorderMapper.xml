<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.prj.cosm.material.morder.mapper.MorderMapper">
	<!-- 입고 리스트 전체 조회 -->
	
	<select id="mioInputList" resultType="MorderVO">
		SELECT mio.mio_no,
			   mo.mo_name,
			   mio.mio_input_quantity AS mio_in_qntt,
			   mio.mio_date
			  FROM material_io mio JOIN material_order mo
    		  		ON mo.mo_material_id = mio.mio_no
   			WHERE mio_progress = 'L0103'
		<if test="startDate != null and endDate != null">
			AND TRUNC(mio.mio_date) BETWEEN #{startDate} AND #{endDate}
		</if>
		ORDER BY mio_date
	</select>

	<!-- 출고 리스트 전체 조회 -->
	<select id="mioOutputList" resultType="MorderVO">
		SELECT mio_no,
				m.m_name as mio_name,
				mio.mio_output_quantity AS mio_out_qntt,
				mio.mio_date		
		FROM material_io mio JOIN material m
			ON m.m_no = mio.mio_no
		WHERE mio_progress = 'L0104'
		<if test="startDate != null and endDate != null">
		AND TRUNC(mio.mio_date) BETWEEN #{startDate} AND #{endDate}
		</if>
		ORDER BY mio_date
	</select>

	<!-- 입고 대기 리스트 전체 조회 -->
	<select id="getStandbyList" resultType="MorderVO">
	SELECT mo.mo_material_id,
			   mo.mo_name, 
			   mc.mc_company_name as mo_com_nm, 
			   mo.mo_num
		FROM material_order mo 
        JOIN material_company mc
				ON mc.mc_company_id = mo.mo_company_id
		WHERE mo_progress_code = 'L0102'

	
	
		<!--  SELECT mo.mo_material_id,
			   mo.mo_name, 
			   mc.mc_company_name as mo_com_nm, 
			   mo.mo_num,
			   mio.mio_input_quantity as mio_int_qntt, 
			   mio_quality 
		FROM material_order mo 
        JOIN material_company mc
				ON mc.mc_company_id = mo.mo_company_id
		JOIN material_io mio
				ON mio.mio_mo_order_id = mo.mo_order_id-->
        
	</select>
	
	<!-- 입고 대기 -> 입고 확정 -->
	<insert id="insertInputOrder" parameterType="MorderVO">
		INSERT INTO material_io(mio_no,
									mio_company_id,
									mio_company_name,
									mio_input_quantity,
									mio_progress,
									mio_quality)
		SELECT mo_material_id, 
			   mo_company_id, 
			   #{moComNm}, 
			   #{mioInQntt},
			   'L0103', 
			   #{mioQuality}
		FROM material_order
		WHERE mo_material_id = #{moMaterialId}							
									
									
		
							
	</insert>
	
</mapper>